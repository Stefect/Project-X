<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chromium Browser</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .container {
      display: flex;
      height: calc(100vh - 100px); /* 60px toolbar + 40px tabs */
    }

    .main-content {
      flex: 1;
    }

    #notes-sidebar {
      width: 320px;
      background: #f8f9fa;
      border-left: 1px solid #dadce0;
      padding: 15px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      overflow-x: visible;
      transition: width 0.3s ease, padding 0.3s ease;
      position: relative;
    }

    /* –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–∞–Ω–µ–ª—å –∑–≥–æ—Ä–Ω—É—Ç–∞ */
    #notes-sidebar.collapsed,
    #notes-sidebar:not(.expanded) {
      width: 0;
      padding: 0;
      border-left: none;
      overflow: hidden;
    }

    #notes-sidebar h3 {
      margin: 0 0 15px 0;
      color: #202124;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    #toggle-sidebar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    #toggle-sidebar:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    #notes-sidebar h3 {
      margin: 0 0 15px 0;
      color: #202124;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: space-between;
      padding-bottom: 10px;
      border-bottom: 2px solid #e8eaed;
    }
    
    #notes-sidebar h3 .shared-badge {
      font-size: 11px;
      background: #34a853;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: normal;
    }

    #notes-list {
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 15px;
      border: 1px solid #e0e0e0;
      background: white;
      border-radius: 8px;
      padding: 8px;
    }

    .note-item {
      border-bottom: 1px solid #f0f0f0;
      padding: 8px;
      font-size: 13px;
      line-height: 1.5;
      color: #3c4043;
      position: relative;
      padding-right: 30px;
    }

    .note-item:last-child {
      border-bottom: none;
    }

    .note-item .delete-btn {
      position: absolute;
      right: 8px;
      top: 8px;
      background: transparent;
      border: none;
      cursor: pointer;
      color: #dc3545;
      font-size: 16px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .note-item:hover .delete-btn {
      opacity: 1;
    }

    #summarize-btn, #clear-btn {
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      margin-bottom: 8px;
    }

    #summarize-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    #summarize-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    #clear-btn {
      background: #f1f3f4;
      color: #5f6368;
    }

    #clear-btn:hover {
      background: #e8eaed;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #80868b;
      font-size: 13px;
    }

    .toolbar {
      height: 60px;
      background: #f1f3f4;
      display: flex;
      align-items: center;
      padding: 0 10px;
      gap: 10px;
      border-bottom: 1px solid #dadce0;
    }

    .nav-button {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .nav-button:hover {
      background: #e8eaed;
    }

    .nav-button:active {
      background: #dadce0;
    }

    .address-bar {
      flex: 1;
      height: 38px;
      padding: 0 15px;
      border: 1px solid #dadce0;
      border-radius: 24px;
      font-size: 14px;
      outline: none;
      background: white;
    }

    .address-bar:focus {
      border-color: #1a73e8;
      box-shadow: 0 1px 6px rgba(26, 115, 232, 0.3);
    }

    /* –†–æ–∑—É–º–Ω–∏–π –ø–æ—à—É–∫ */
    #smart-search-box {
      display: none;
      position: absolute;
      top: 70px;
      right: 340px;
      width: 350px;
      background: white;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      border-radius: 12px;
      z-index: 10000;
      border: 2px solid #667eea;
    }

    #smart-search-box h4 {
      margin: 0 0 15px 0;
      color: #333;
      font-size: 18px;
    }

    #search-query {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 12px;
    }

    #search-query:focus {
      outline: none;
      border-color: #667eea;
    }

    #btn-smart-find {
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    #btn-smart-find:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    #btn-smart-find:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #search-status {
      margin-top: 12px;
      font-size: 13px;
      color: #666;
      min-height: 20px;
      text-align: center;
    }

    .smart-search-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 16px;
      border-radius: 4px;
      margin-left: 5px;
      transition: all 0.2s;
    }

    .smart-search-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    /* –ü–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ */
    .tabs-bar {
      height: 40px;
      background: #dee1e6;
      display: flex;
      align-items: flex-end;
      padding: 0 5px;
      border-bottom: 1px solid #c1c4c9;
      overflow-x: auto;
      overflow-y: hidden;
    }

    .tabs-bar::-webkit-scrollbar {
      height: 3px;
    }

    .tabs-bar::-webkit-scrollbar-thumb {
      background: #999;
      border-radius: 2px;
    }

    .tab {
      min-width: 150px;
      max-width: 240px;
      height: 34px;
      background: #bdc0c5;
      border-radius: 8px 8px 0 0;
      margin-right: 2px;
      padding: 0 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      border: 1px solid #999;
      border-bottom: none;
      transition: all 0.15s;
      position: relative;
    }

    .tab:hover {
      background: #c8cad0;
    }

    .tab.active {
      background: #f8f9fa;
      height: 36px;
      border-color: #c1c4c9;
      z-index: 1;
    }

    .tab-favicon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .tab-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 13px;
      color: #333;
    }

    .tab.active .tab-title {
      font-weight: 500;
    }

    .tab-close {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      flex-shrink: 0;
      opacity: 0;
      transition: opacity 0.15s;
    }

    .tab:hover .tab-close {
      opacity: 1;
    }

    .tab-close:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    .tab.active .tab-close {
      opacity: 1;
    }

    .new-tab-btn {
      width: 32px;
      height: 32px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .new-tab-btn:hover {
      background: rgba(0, 0, 0, 0.05);
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <button class="nav-button" id="back" title="–ù–∞–∑–∞–¥">‚óÑ</button>
    <button class="nav-button" id="forward" title="–í–ø–µ—Ä–µ–¥">‚ñ∫</button>
    <button class="nav-button" id="reload" title="–û–Ω–æ–≤–∏—Ç–∏">‚ü≥</button>
    <input type="text" class="address-bar" id="url" placeholder="–í–≤–µ–¥—ñ—Ç—å URL –∞–±–æ –ø–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç">
    <button class="smart-search-btn" id="toggle-sidebar-toolbar" title="–ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç (Ctrl+B)">üìù</button>
  </div>

  <!-- –ü–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ -->
  <div class="tabs-bar" id="tabs-bar">
    <div class="tab active" data-tab-id="1">
      <img class="tab-favicon" src="https://www.google.com/favicon.ico" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2214%22>üåê</text></svg>'">
      <span class="tab-title">–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞</span>
      <span class="tab-close">‚úï</span>
    </div>
    <button class="new-tab-btn" id="new-tab-btn" title="–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞ (Ctrl+T)">+</button>
  </div>

  <div class="container">
    <div class="main-content"></div>
    
    <div id="notes-sidebar" class="collapsed" style="width: 0; padding: 0; overflow: hidden; border-left: none;">
      <h3>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span>üìù –ú—ñ–π –ö–æ–Ω—Å–ø–µ–∫—Ç</span>
          <span class="shared-badge" title="–ù–æ—Ç–∞—Ç–∫–∏ —Å–ø—ñ–ª—å–Ω—ñ –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫">üåê –°–ø—ñ–ª—å–Ω—ñ</span>
        </div>
        <button id="toggle-sidebar" title="–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å">‚ò∞</button>
      </h3>
      
      <div id="notes-list">
        <div class="empty-state">–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞<br>–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ</div>
      </div>

      <button id="summarize-btn">‚ú® –£–∑–∞–≥–∞–ª—å–Ω–∏—Ç–∏ —á–µ—Ä–µ–∑ –®–Ü</button>
      <button id="clear-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    
    const backBtn = document.getElementById('back');
    const forwardBtn = document.getElementById('forward');
    const reloadBtn = document.getElementById('reload');
    const urlInput = document.getElementById('url');
    const notesList = document.getElementById('notes-list');
    const summarizeBtn = document.getElementById('summarize-btn');
    const clearBtn = document.getElementById('clear-btn');
    
    // Toggle –±–æ–∫–æ–≤–æ—ó –ø–∞–Ω–µ–ª—ñ
    const notesSidebar = document.getElementById('notes-sidebar');
    const toggleSidebarBtn = document.getElementById('toggle-sidebar');
    const toggleSidebarToolbar = document.getElementById('toggle-sidebar-toolbar');
    
    // –í–∫–ª–∞–¥–∫–∏
    const tabsBar = document.getElementById('tabs-bar');
    const newTabBtn = document.getElementById('new-tab-btn');
    
    let collectedNotes = [];
    
    // –í–ò–î–ê–õ–Ø–Ñ–ú–û —Å—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ localStorage, —â–æ–± –ø–∞–Ω–µ–ª—å –∑–∞–≤–∂–¥–∏ –±—É–ª–∞ –∑–≥–æ—Ä–Ω—É—Ç–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
    localStorage.removeItem('sidebarCollapsed');
    
    let isSidebarCollapsed = true; // –ó–∞–≤–∂–¥–∏ –∑–≥–æ—Ä–Ω—É—Ç–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
    let currentTabId = 1; // –ü–æ—Ç–æ—á–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞ –≤–∫–ª–∞–¥–∫–∞

    // ========== –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª–∞–¥–æ–∫ ==========
    
    // –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –≤–∫–ª–∞–¥–∫—É
    async function createTab(url = 'https://www.google.com') {
      const result = await ipcRenderer.invoke('create-tab', url);
      
      // –°—Ç–≤–æ—Ä—é—î–º–æ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
      const tabElement = document.createElement('div');
      tabElement.className = 'tab';
      tabElement.dataset.tabId = result.id;
      
      tabElement.innerHTML = `
        <img class="tab-favicon" src="https://www.google.com/favicon.ico" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2214%22>üåê</text></svg>'">
        <span class="tab-title">${result.title}</span>
        <span class="tab-close">‚úï</span>
      `;
      
      // –î–æ–¥–∞—î–º–æ –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ—é "+"
      tabsBar.insertBefore(tabElement, newTabBtn);
      
      // –ü–µ—Ä–µ–º–∏–∫–∞—î–º–æ—Å—å –Ω–∞ –Ω–æ–≤—É –≤–∫–ª–∞–¥–∫—É
      switchTab(result.id);
      
      return result.id;
    }
    
    // –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É
    function switchTab(tabId) {
      // –ó–Ω—ñ–º–∞—î–º–æ –∫–ª–∞—Å active –∑ —É—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // –î–æ–¥–∞—î–º–æ active –¥–æ –≤–∏–±—Ä–∞–Ω–æ—ó
      const targetTab = document.querySelector(`[data-tab-id="${tabId}"]`);
      if (targetTab) {
        targetTab.classList.add('active');
        currentTabId = tabId;
        ipcRenderer.send('switch-tab', tabId);
      }
    }
    
    // –ó–∞–∫—Ä–∏—Ç–∏ –≤–∫–ª–∞–¥–∫—É
    function closeTab(tabId) {
      const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
      if (tabElement) {
        tabElement.remove();
      }
      ipcRenderer.send('close-tab', tabId);
    }
    
    // –û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤–∫–ª–∞–¥–∫–∏ (–∑–∞–≥–æ–ª–æ–≤–æ–∫, favicon)
    ipcRenderer.on('update-tab-info', (event, tabId, title, url) => {
      const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
      if (tabElement) {
        const titleElement = tabElement.querySelector('.tab-title');
        const faviconElement = tabElement.querySelector('.tab-favicon');
        
        if (titleElement) titleElement.textContent = title || '–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞';
        
        if (faviconElement && url) {
          const faviconUrl = new URL(url).origin + '/favicon.ico';
          faviconElement.src = faviconUrl;
        }
      }
    });
    
    // –û–Ω–æ–≤–∏—Ç–∏ URL bar
    ipcRenderer.on('update-url-bar', (event, url) => {
      urlInput.value = url;
    });
    
    // –Ø–∫—â–æ –≤—Å—ñ –≤–∫–ª–∞–¥–∫–∏ –∑–∞–∫—Ä–∏—Ç–æ, —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É
    ipcRenderer.on('create-default-tab', () => {
      createTab();
    });
    
    // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
    tabsBar.addEventListener('click', (e) => {
      const tab = e.target.closest('.tab');
      if (!tab) return;
      
      const tabId = parseInt(tab.dataset.tabId);
      
      // –Ø–∫—â–æ –∫–ª—ñ–∫–Ω—É–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä–∏—Ç—Ç—è
      if (e.target.classList.contains('tab-close')) {
        e.stopPropagation();
        closeTab(tabId);
      } else {
        // –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É
        switchTab(tabId);
      }
    });
    
    // –ö–Ω–æ–ø–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –≤–∫–ª–∞–¥–∫–∏
    newTabBtn.addEventListener('click', () => {
      createTab();
    });
    
    // –ì–∞—Ä—è—á–∞ –∫–ª–∞–≤—ñ—à–∞ Ctrl+T –¥–ª—è –Ω–æ–≤–æ—ó –≤–∫–ª–∞–¥–∫–∏
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 't') {
        e.preventDefault();
        createTab();
      }
    });

    // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —Å—Ç–∞–Ω (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–≥–æ—Ä–Ω—É—Ç–∞)
    if (isSidebarCollapsed) {
      notesSidebar.classList.add('collapsed');
      toggleSidebarBtn.textContent = '‚ò∞';
      toggleSidebarBtn.title = '–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å';
    } else {
      notesSidebar.classList.add('expanded');
      toggleSidebarBtn.textContent = '‚úï';
      toggleSidebarBtn.title = '–ó–≥–æ—Ä–Ω—É—Ç–∏ –ø–∞–Ω–µ–ª—å';
    }

    // –§—É–Ω–∫—Ü—ñ—è toggle –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—Å—é–¥–∏
    function toggleSidebar() {
      isSidebarCollapsed = !isSidebarCollapsed;
      
      // –û—á–∏—â–∞—î–º–æ inline —Å—Ç–∏–ª—ñ, —â–æ–± CSS –∫–ª–∞—Å–∏ –ø—Ä–∞—Ü—é–≤–∞–ª–∏
      notesSidebar.style.width = '';
      notesSidebar.style.padding = '';
      notesSidebar.style.overflow = '';
      notesSidebar.style.borderLeft = '';
      
      if (isSidebarCollapsed) {
        notesSidebar.classList.remove('expanded');
        notesSidebar.classList.add('collapsed');
      } else {
        notesSidebar.classList.remove('collapsed');
        notesSidebar.classList.add('expanded');
      }
      
      toggleSidebarBtn.textContent = isSidebarCollapsed ? '‚ò∞' : '‚úï';
      toggleSidebarBtn.title = isSidebarCollapsed ? '–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å' : '–ó–≥–æ—Ä–Ω—É—Ç–∏ –ø–∞–Ω–µ–ª—å';
      localStorage.setItem('sidebarCollapsed', isSidebarCollapsed);
      ipcRenderer.send('sidebar-toggled', isSidebarCollapsed);
    }

    // –ö–Ω–æ–ø–∫–∞ –≤ toolbar
    toggleSidebarToolbar.addEventListener('click', toggleSidebar);

    // –û–±—Ä–æ–±–Ω–∏–∫ toggle –ø–∞–Ω–µ–ª—ñ (–∫–Ω–æ–ø–∫–∞ X –≤ –∑–∞–≥–æ–ª–æ–≤–∫—É)
    toggleSidebarBtn.addEventListener('click', toggleSidebar);

    // –ì–∞—Ä—è—á–∞ –∫–ª–∞–≤—ñ—à–∞ Ctrl+B –¥–ª—è toggle –ø–∞–Ω–µ–ª—ñ
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'b') {
        e.preventDefault();
        toggleSidebar();
      }
    });

    // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
    backBtn.addEventListener('click', () => {
      ipcRenderer.send('go-back');
    });

    forwardBtn.addEventListener('click', () => {
      ipcRenderer.send('go-forward');
    });

    reloadBtn.addEventListener('click', () => {
      ipcRenderer.send('reload');
    });

    urlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        ipcRenderer.send('navigate', urlInput.value);
      }
    });

    // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–µ–∫—Å—Ç –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é (–°–ü–Ü–õ–¨–ù–Ü –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    ipcRenderer.on('add-to-notes', (event, text) => {
      addNote(text);
    });

    // –î–æ–¥–∞—î–º–æ –Ω–æ—Ç–∞—Ç–∫—É (—Å–ø—ñ–ª—å–Ω—É –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    function addNote(text) {
      // –í–∏–¥–∞–ª—è—î–º–æ empty state –ø—Ä–∏ –ø–µ—Ä—à—ñ–π –Ω–æ—Ç–∞—Ç—Ü—ñ
      const emptyState = notesList.querySelector('.empty-state');
      if (emptyState) {
        emptyState.remove();
      }

      const noteId = Date.now(); // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –∑–∞–º—ñ—Å—Ç—å —ñ–Ω–¥–µ–∫—Å—É
      collectedNotes.push({ id: noteId, text: text });
      
      const noteItem = document.createElement('div');
      noteItem.className = 'note-item';
      noteItem.dataset.noteId = noteId;
      noteItem.innerHTML = `
        <span>‚Ä¢ ${text}</span>
        <button class="delete-btn" onclick="deleteNote(${noteId})">‚úï</button>
      `;
      
      notesList.appendChild(noteItem);
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage
      localStorage.setItem('sharedNotes', JSON.stringify(collectedNotes));
    }

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–æ—Ç–∞—Ç–∫–∏
    window.deleteNote = function(noteId) {
      const index = collectedNotes.findIndex(note => note.id === noteId);
      if (index !== -1) {
        collectedNotes.splice(index, 1);
        
        // –í–∏–¥–∞–ª—è—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –∑ DOM
        const noteElement = document.querySelector(`[data-note-id="${noteId}"]`);
        if (noteElement) {
          noteElement.remove();
        }
        
        // –ü–æ–∫–∞–∑—É—î–º–æ empty state —è–∫—â–æ –Ω–µ–º–∞—î –Ω–æ—Ç–∞—Ç–æ–∫
        if (collectedNotes.length === 0) {
          notesList.innerHTML = '<div class="empty-state">–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞<br>–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ</div>';
        }
        
        // –û–Ω–æ–≤–ª—é—î–º–æ localStorage
        localStorage.setItem('sharedNotes', JSON.stringify(collectedNotes));
      }
    };

    // –£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –®–Ü (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –°–ü–Ü–õ–¨–ù–Ü –Ω–æ—Ç–∞—Ç–∫–∏)
    summarizeBtn.addEventListener('click', async () => {
      if (collectedNotes.length === 0) {
        alert('–ö–æ–Ω—Å–ø–µ–∫—Ç –ø–æ—Ä–æ–∂–Ω—ñ–π! –í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ.');
        return;
      }

      // –í–∏—Ç—è–≥—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —Ç–µ–∫—Å—Ç –∑ –æ–±'—î–∫—Ç—ñ–≤ –Ω–æ—Ç–∞—Ç–æ–∫
      const notesText = collectedNotes.map(note => note.text || note).join('\n---\n');
      const prompt = `–Ø –∑—ñ–±—Ä–∞–≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏ –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π —ó—Ö, —Å—Ç—Ä—É–∫—Ç—É—Ä—É–π, –≤–∏–¥–∞–ª–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏ —Ç–∞ —Å—Ç–≤–æ—Ä–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é:\n\n${notesText}`;

      summarizeBtn.textContent = '‚è≥ –î—É–º–∞—é...';
      summarizeBtn.disabled = true;

      try {
        const result = await ipcRenderer.invoke('ask-gemini', prompt);
        
        // –ó–∞–º—ñ–Ω—é—î–º–æ —Å–ø–∏—Å–æ–∫ –Ω–∞ —É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è
        notesList.innerHTML = `<div style="padding: 10px; line-height: 1.6; white-space: pre-wrap;">${result}</div>`;
        collectedNotes = [];
      } catch (error) {
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—ñ: ' + error.message);
      } finally {
        summarizeBtn.textContent = '‚ú® –£–∑–∞–≥–∞–ª—å–Ω–∏—Ç–∏ —á–µ—Ä–µ–∑ –®–Ü';
        summarizeBtn.disabled = false;
      }
    });

    // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ (–°–ü–Ü–õ–¨–ù–Ü –Ω–æ—Ç–∞—Ç–∫–∏ –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    clearBtn.addEventListener('click', () => {
      if (collectedNotes.length === 0 && !notesList.querySelector('.empty-state')) {
        return;
      }
      
      if (confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –Ω–æ—Ç–∞—Ç–∫–∏?')) {
        collectedNotes = [];
        notesList.innerHTML = '<div class="empty-state">–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞<br>–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ</div>';
        localStorage.removeItem('sharedNotes');
      }
    });

    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ (–°–ü–Ü–õ–¨–ù–Ü –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    const savedNotes = localStorage.getItem('sharedNotes');
    if (savedNotes) {
      try {
        const parsed = JSON.parse(savedNotes);
        parsed.forEach(note => {
          const text = note.text || note; // –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É
          const noteId = note.id || Date.now() + Math.random();
          
          if (collectedNotes.length === 0) {
            const emptyState = notesList.querySelector('.empty-state');
            if (emptyState) emptyState.remove();
          }
          
          collectedNotes.push({ id: noteId, text: text });
          
          const noteItem = document.createElement('div');
          noteItem.className = 'note-item';
          noteItem.dataset.noteId = noteId;
          noteItem.innerHTML = `
            <span>‚Ä¢ ${text}</span>
            <button class="delete-btn" onclick="deleteNote(${noteId})">‚úï</button>
          `;
          notesList.appendChild(noteItem);
        });
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ—Ç–∞—Ç–æ–∫:', e);
      }
    }
  </script>
</body>
</html>
