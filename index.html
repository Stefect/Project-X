<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AI Browser</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .container {
      display: flex;
      height: calc(100vh - 100px); /* 40px tabs + 60px toolbar */
    }

    .main-content {
      flex: 1;
    }

    #notes-sidebar {
      width: 320px;
      background: linear-gradient(to bottom, #f0f9ff 0%, #ffffff 100%);
      border-left: 1px solid #bfdbfe;
      padding: 15px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      overflow-x: visible;
      transition: width 0.3s ease, padding 0.3s ease;
      position: relative;
      box-shadow: -2px 0 8px rgba(59, 130, 246, 0.05);
    }

    /* –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–∞–Ω–µ–ª—å –∑–≥–æ—Ä–Ω—É—Ç–∞ */
    #notes-sidebar.collapsed,
    #notes-sidebar:not(.expanded) {
      width: 0;
      padding: 0;
      border-left: none;
      overflow: hidden;
    }

    #notes-sidebar h3 {
      margin: 0 0 15px 0;
      color: #202124;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    #toggle-sidebar {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    #toggle-sidebar:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.5);
      background: linear-gradient(135deg, #2563eb 0%, #1e3a8a 100%);
    }

    #notes-sidebar h3 {
      margin: 0 0 15px 0;
      color: #202124;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: space-between;
      padding-bottom: 10px;
      border-bottom: 2px solid #e8eaed;
    }
    
    #notes-sidebar h3 .shared-badge {
      font-size: 11px;
      background: #34a853;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: normal;
    }

    .translator-section {
      margin-bottom: 15px;
      padding: 12px;
      background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
      border-radius: 10px;
      border: 1px solid #3b82f6;
    }

    .translator-section h4 {
      margin: 0 0 10px 0;
      color: #1e40af;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .language-select {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #3b82f6;
      border-radius: 8px;
      font-size: 13px;
      background: white;
      color: #1e40af;
      cursor: pointer;
      outline: none;
      font-weight: 500;
    }

    .language-select:hover {
      background: #f0f9ff;
      border-color: #2563eb;
    }

    .language-select:focus {
      border-color: #1e40af;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    #notes-list {
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 15px;
      border: 1px solid #e0e0e0;
      background: white;
      border-radius: 8px;
      padding: 8px;
    }

    .note-item {
      border-bottom: 1px solid #e3e8f0;
      padding: 10px;
      font-size: 13px;
      line-height: 1.5;
      color: #1e293b;
      position: relative;
      padding-right: 30px;
      background: white;
      border-left: 3px solid #3b82f6;
      margin-bottom: 6px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(59, 130, 246, 0.08);
      transition: all 0.2s;
    }
    
    .note-item:hover {
      box-shadow: 0 3px 10px rgba(59, 130, 246, 0.15);
      transform: translateX(2px);
      border-left-color: #2563eb;
    }

    .note-item:last-child {
      border-bottom: none;
    }

    .note-item .delete-btn {
      position: absolute;
      right: 8px;
      top: 8px;
      background: transparent;
      border: none;
      cursor: pointer;
      color: #dc2626;
      font-size: 16px;
      opacity: 0;
      transition: all 0.2s;
    }

    .note-item:hover .delete-btn {
      opacity: 1;
    }

    #summarize-btn, #clear-btn {
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      margin-bottom: 8px;
    }

    #summarize-btn {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      color: white;
      box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
    }

    #summarize-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5);
      background: linear-gradient(135deg, #2563eb 0%, #1e3a8a 100%);
    }

    #clear-btn {
      background: #f0f6ff;
      color: #1e40af;
      border: 1px solid #bfdbfe;
    }

    #clear-btn:hover {
      background: #dbeafe;
      border-color: #3b82f6;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #80868b;
      font-size: 13px;
    }

    .toolbar {
      height: 60px;
      background: #ffffff;
      display: flex;
      align-items: center;
      padding: 0 10px;
      gap: 10px;
      border-bottom: 1px solid #e3e8f0;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .nav-button {
      width: 36px;
      height: 36px;
      border: 1px solid #d1e0ff;
      background: #f0f6ff;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #1e40af;
      transition: all 0.2s;
    }

    .nav-button:hover {
      background: #dbeafe;
      border-color: #3b82f6;
      color: #1e3a8a;
      transform: scale(1.05);
    }

    .nav-button:active {
      background: #bfdbfe;
    }

    .organize-btn {
      height: 36px;
      padding: 0 16px;
      border: 2px solid #10b981;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
    }

    .organize-btn:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .organize-btn:active {
      transform: translateY(0);
    }

    .vpn-btn {
      height: 36px;
      padding: 0 14px;
      border: 2px solid #94a3b8;
      background: #f1f5f9;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: #64748b;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    .vpn-btn.connected {
      border-color: #10b981;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }

    .vpn-btn.connecting {
      border-color: #f59e0b;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      animation: pulse 1.5s infinite;
    }

    .vpn-btn:hover:not(.connecting) {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .vpn-btn:active {
      transform: translateY(0);
    }

    .address-bar {
      flex: 1;
      height: 40px;
      padding: 0 15px;
      border: 2px solid #e3e8f0;
      border-radius: 20px;
      font-size: 14px;
      outline: none;
      background: #f8fafc;
      transition: all 0.2s;
    }

    .address-bar:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background: #ffffff;
    }

    /* –†–æ–∑—É–º–Ω–∏–π –ø–æ—à—É–∫ */
    #smart-search-box {
      display: none;
      position: absolute;
      top: 70px;
      right: 340px;
      width: 350px;
      background: white;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      border-radius: 12px;
      z-index: 10000;
      border: 2px solid #667eea;
    }

    #smart-search-box h4 {
      margin: 0 0 15px 0;
      color: #333;
      font-size: 18px;
    }

    #search-query {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 12px;
    }

    #search-query:focus {
      outline: none;
      border-color: #667eea;
    }

    #btn-smart-find {
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    #btn-smart-find:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    #btn-smart-find:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #search-status {
      margin-top: 12px;
      font-size: 13px;
      color: #666;
      min-height: 20px;
      text-align: center;
    }

    .smart-search-btn {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 16px;
      border-radius: 8px;
      margin-left: 5px;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    .smart-search-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.5);
      background: linear-gradient(135deg, #2563eb 0%, #1e3a8a 100%);
    }

    /* –ü–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ (–∑ –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ñ–∫–Ω–∞, —è–∫ Chrome) */
    .tabs-bar {
      height: 40px;
      background: linear-gradient(to bottom, #e0e7ff 0%, #dbeafe 100%);
      display: flex;
      align-items: flex-end;
      padding: 0 5px;
      border-bottom: 1px solid #bfdbfe;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-app-region: drag;
      position: relative;
    }

    .tabs-container {
      display: flex;
      align-items: flex-end;
      flex: 1;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-app-region: no-drag;
    }

    .tabs-bar::-webkit-scrollbar {
      height: 3px;
    }

    .tabs-bar::-webkit-scrollbar-thumb {
      background: #999;
      border-radius: 2px;
    }

    /* –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–∫–Ω–æ–º (—ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ –≤ –ø–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫) */
    .window-controls {
      display: flex;
      height: 40px;
      align-items: center;
      -webkit-app-region: no-drag;
      margin-left: auto;
    }

    .window-btn {
      width: 46px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      color: #1e40af;
      cursor: pointer;
      transition: all 0.15s;
    }

    .window-btn:hover {
      background: rgba(59, 130, 246, 0.15);
    }

    .window-btn.close:hover {
      background: #dc2626;
      color: white;
    }

    .tab {
      min-width: 150px;
      max-width: 240px;
      height: 34px;
      background: #bfdbfe;
      border-radius: 8px 8px 0 0;
      margin-right: 2px;
      padding: 0 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      border: 1px solid #93c5fd;
      border-bottom: none;
      transition: all 0.15s;
      position: relative;
    }

    .tab:hover {
      background: #dbeafe;
    }

    .tab.active {
      background: #ffffff;
      height: 36px;
      border-color: #bfdbfe;
      z-index: 1;
      box-shadow: 0 -2px 8px rgba(59, 130, 246, 0.1);
    }

    .tab-favicon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .tab-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 13px;
      color: #333;
    }

    .tab.active .tab-title {
      font-weight: 500;
    }

    .tab-close {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      flex-shrink: 0;
      opacity: 0;
      transition: opacity 0.15s;
    }

    .tab:hover .tab-close {
      opacity: 1;
    }

    .tab-close:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    .tab.active .tab-close {
      opacity: 1;
    }

    .new-tab-btn {
      width: 32px;
      height: 32px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .new-tab-btn:hover {
      background: rgba(0, 0, 0, 0.05);
    }
  </style>
</head>
<body>
  <!-- –ü–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ –∑ –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ñ–∫–Ω–∞ -->
  <div class="tabs-bar" id="tabs-bar">
    <div class="tabs-container">
      <div class="tab active" data-tab-id="1">
        <img class="tab-favicon" src="https://www.google.com/favicon.ico" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2214%22>üåê</text></svg>'">
        <span class="tab-title">–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞</span>
        <span class="tab-close">‚úï</span>
      </div>
      <button class="new-tab-btn" id="new-tab-btn" title="–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞ (Ctrl+T)">+</button>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–∫–Ω–æ–º -->
    <div class="window-controls">
      <button class="window-btn" id="minimize-btn" title="–ó–≥–æ—Ä–Ω—É—Ç–∏">
        <svg width="10" height="1" viewBox="0 0 10 1"><path fill="currentColor" d="M0 0h10v1H0z"/></svg>
      </button>
      <button class="window-btn" id="maximize-btn" title="–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏">
        <svg width="10" height="10" viewBox="0 0 10 10"><path fill="currentColor" d="M0 0v10h10V0H0zm1 1h8v8H1V1z"/></svg>
      </button>
      <button class="window-btn close" id="close-btn" title="–ó–∞–∫—Ä–∏—Ç–∏">
        <svg width="10" height="10" viewBox="0 0 10 10"><path fill="currentColor" d="M0 0l1-1 4 4 4-4 1 1-4 4 4 4-1 1-4-4-4 4-1-1 4-4z"/></svg>
      </button>
    </div>
  </div>

  <div class="toolbar">
    <button class="nav-button" id="back" title="–ù–∞–∑–∞–¥">‚óÑ</button>
    <button class="nav-button" id="forward" title="–í–ø–µ—Ä–µ–¥">‚ñ∫</button>
    <button class="nav-button" id="reload" title="–û–Ω–æ–≤–∏—Ç–∏">‚ü≥</button>
    <input type="text" class="address-bar" id="url" placeholder="–í–≤–µ–¥—ñ—Ç—å URL –∞–±–æ –ø–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç">
    <button class="vpn-btn" id="vpn-btn" title="Cloudflare WARP VPN">üõ°Ô∏è VPN</button>
    <button class="organize-btn" id="organize-tabs-btn" title="AI –æ—Ä–≥–∞–Ω—ñ–∑—É—î –≤–∫–ª–∞–¥–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ">üßπ –ù–∞–≤–µ—Å—Ç–∏ –ª–∞–¥</button>
    <button class="smart-search-btn" id="toggle-sidebar-toolbar" title="–ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç (Ctrl+B)">üìù</button>
  </div>

  <div class="container">
    <div class="main-content"></div>
    
    <div id="notes-sidebar" class="collapsed" style="width: 0; padding: 0; overflow: hidden; border-left: none;">
      <h3>
        <span>üìù –ú—ñ–π –ö–æ–Ω—Å–ø–µ–∫—Ç</span>
        <button id="toggle-sidebar" title="–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å">‚ò∞</button>
      </h3>
      
      <div id="notes-list">
        <div class="empty-state">–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞<br>–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ</div>
      </div>

      <button id="summarize-btn">‚ú® –£–∑–∞–≥–∞–ª—å–Ω–∏—Ç–∏ —á–µ—Ä–µ–∑ –®–Ü</button>
      <button id="clear-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    
    // ========== –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–∫–Ω–æ–º ==========
    const minimizeBtn = document.getElementById('minimize-btn');
    const maximizeBtn = document.getElementById('maximize-btn');
    const closeBtn = document.getElementById('close-btn');
    
    minimizeBtn.addEventListener('click', () => {
      ipcRenderer.send('window-minimize');
    });
    
    maximizeBtn.addEventListener('click', () => {
      ipcRenderer.send('window-maximize');
    });
    
    closeBtn.addEventListener('click', () => {
      ipcRenderer.send('window-close');
    });
    
    const backBtn = document.getElementById('back');
    const forwardBtn = document.getElementById('forward');
    const reloadBtn = document.getElementById('reload');
    const urlInput = document.getElementById('url');
    const notesList = document.getElementById('notes-list');
    const summarizeBtn = document.getElementById('summarize-btn');
    const clearBtn = document.getElementById('clear-btn');
    
    // Toggle –±–æ–∫–æ–≤–æ—ó –ø–∞–Ω–µ–ª—ñ
    const notesSidebar = document.getElementById('notes-sidebar');
    const toggleSidebarBtn = document.getElementById('toggle-sidebar');
    const toggleSidebarToolbar = document.getElementById('toggle-sidebar-toolbar');
    
    // –í–∫–ª–∞–¥–∫–∏
    const tabsBar = document.getElementById('tabs-bar');
    const tabsContainer = tabsBar.querySelector('.tabs-container');
    const newTabBtn = document.getElementById('new-tab-btn');
    
    let collectedNotes = [];
    
    // –í–ò–î–ê–õ–Ø–Ñ–ú–û —Å—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ localStorage, —â–æ–± –ø–∞–Ω–µ–ª—å –∑–∞–≤–∂–¥–∏ –±—É–ª–∞ –∑–≥–æ—Ä–Ω—É—Ç–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
    localStorage.removeItem('sidebarCollapsed');
    
    let isSidebarCollapsed = true; // –ó–∞–≤–∂–¥–∏ –∑–≥–æ—Ä–Ω—É—Ç–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
    let currentTabId = 1; // –ü–æ—Ç–æ—á–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞ –≤–∫–ª–∞–¥–∫–∞

    // ========== –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª–∞–¥–æ–∫ ==========
    
    // –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –≤–∫–ª–∞–¥–∫—É
    async function createTab(url = 'https://www.google.com') {
      const result = await ipcRenderer.invoke('create-tab', url);
      
      // –°—Ç–≤–æ—Ä—é—î–º–æ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
      const tabElement = document.createElement('div');
      tabElement.className = 'tab';
      tabElement.dataset.tabId = result.id;
      
      tabElement.innerHTML = `
        <img class="tab-favicon" src="https://www.google.com/favicon.ico" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2214%22>üåê</text></svg>'">
        <span class="tab-title">${result.title}</span>
        <span class="tab-close">‚úï</span>
      `;
      
      // –î–æ–¥–∞—î–º–æ –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ—é "+" –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∫–ª–∞–¥–æ–∫
      tabsContainer.insertBefore(tabElement, newTabBtn);
      
      // –ü–µ—Ä–µ–º–∏–∫–∞—î–º–æ—Å—å –Ω–∞ –Ω–æ–≤—É –≤–∫–ª–∞–¥–∫—É
      switchTab(result.id);
      
      return result.id;
    }
    
    // –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É
    function switchTab(tabId) {
      // –ó–Ω—ñ–º–∞—î–º–æ –∫–ª–∞—Å active –∑ —É—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // –î–æ–¥–∞—î–º–æ active –¥–æ –≤–∏–±—Ä–∞–Ω–æ—ó
      const targetTab = document.querySelector(`[data-tab-id="${tabId}"]`);
      if (targetTab) {
        targetTab.classList.add('active');
        currentTabId = tabId;
        ipcRenderer.send('switch-tab', tabId);
      }
    }
    
    // –ó–∞–∫—Ä–∏—Ç–∏ –≤–∫–ª–∞–¥–∫—É
    function closeTab(tabId) {
      const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
      if (tabElement) {
        tabElement.remove();
      }
      ipcRenderer.send('close-tab', tabId);
    }
    
    // –û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤–∫–ª–∞–¥–∫–∏ (–∑–∞–≥–æ–ª–æ–≤–æ–∫, favicon)
    ipcRenderer.on('update-tab-info', (event, tabId, title, url) => {
      const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
      if (tabElement) {
        const titleElement = tabElement.querySelector('.tab-title');
        const faviconElement = tabElement.querySelector('.tab-favicon');
        
        if (titleElement) titleElement.textContent = title || '–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞';
        
        if (faviconElement && url) {
          const faviconUrl = new URL(url).origin + '/favicon.ico';
          faviconElement.src = faviconUrl;
        }
      }
    });
    
    // –û–Ω–æ–≤–∏—Ç–∏ URL bar
    ipcRenderer.on('update-url-bar', (event, url) => {
      urlInput.value = url;
    });
    
    // –Ø–∫—â–æ –≤—Å—ñ –≤–∫–ª–∞–¥–∫–∏ –∑–∞–∫—Ä–∏—Ç–æ, —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É
    ipcRenderer.on('create-default-tab', () => {
      createTab();
    });
    
    // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
    tabsBar.addEventListener('click', (e) => {
      const tab = e.target.closest('.tab');
      if (!tab) return;
      
      const tabId = parseInt(tab.dataset.tabId);
      
      // –Ø–∫—â–æ –∫–ª—ñ–∫–Ω—É–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä–∏—Ç—Ç—è
      if (e.target.classList.contains('tab-close')) {
        e.stopPropagation();
        closeTab(tabId);
      } else {
        // –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É
        switchTab(tabId);
      }
    });
    
    // –ö–Ω–æ–ø–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –≤–∫–ª–∞–¥–∫–∏
    newTabBtn.addEventListener('click', () => {
      createTab();
    });
    
    // –ì–∞—Ä—è—á–∞ –∫–ª–∞–≤—ñ—à–∞ Ctrl+T –¥–ª—è –Ω–æ–≤–æ—ó –≤–∫–ª–∞–¥–∫–∏
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 't') {
        e.preventDefault();
        createTab();
      }
    });

    // ========== –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –≤–∫–ª–∞–¥–æ–∫ —á–µ—Ä–µ–∑ AI ==========
    const organizeTabsBtn = document.getElementById('organize-tabs-btn');
    
    organizeTabsBtn.addEventListener('click', async () => {
      const allTabs = document.querySelectorAll('.tab');
      
      if (allTabs.length < 2) {
        alert('üìå –ü–æ—Ç—Ä—ñ–±–Ω–æ —Ö–æ—á–∞ –± 2 –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó!');
        return;
      }

      // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
      organizeTabsBtn.innerHTML = 'üß† –î—É–º–∞—é...';
      organizeTabsBtn.disabled = true;

      try {
        const result = await ipcRenderer.invoke('organize-tabs');
        
        if (!result.success) {
          alert(result.message || '‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥—Ä—É–ø—É–≤–∞—Ç–∏ –≤–∫–ª–∞–¥–∫–∏');
          organizeTabsBtn.innerHTML = 'üßπ –ù–∞–≤–µ—Å—Ç–∏ –ª–∞–¥';
          organizeTabsBtn.disabled = false;
          return;
        }

        // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
        displayOrganizedGroups(result.groups, result.tabsData);
        
        organizeTabsBtn.innerHTML = '‚úÖ –ì–æ—Ç–æ–≤–æ!';
        setTimeout(() => {
          organizeTabsBtn.innerHTML = 'üßπ –ù–∞–≤–µ—Å—Ç–∏ –ª–∞–¥';
          organizeTabsBtn.disabled = false;
        }, 2000);

      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
        organizeTabsBtn.innerHTML = 'üßπ –ù–∞–≤–µ—Å—Ç–∏ –ª–∞–¥';
        organizeTabsBtn.disabled = false;
      }
    });

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–∏—Ö –≥—Ä—É–ø
    function displayOrganizedGroups(groups, tabsData) {
      // –°—Ç–≤–æ—Ä—é—î–º–æ popup –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
      const popup = document.createElement('div');
      popup.id = 'organize-popup';
      popup.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 3px solid #10b981;
        border-radius: 16px;
        padding: 24px;
        max-width: 600px;
        max-height: 70vh;
        overflow-y: auto;
        z-index: 1000000;
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
        font-family: 'Segoe UI', sans-serif;
      `;
      
      let groupsHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; color: #10b981; font-size: 22px;">üßò‚Äç‚ôÇÔ∏è AI –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞–≤ –≤–∞—à—ñ –≤–∫–ª–∞–¥–∫–∏</h2>
          <button id="close-organize-popup" style="
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 14px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
          ">‚úï</button>
        </div>
      `;

      groups.forEach((group, idx) => {
        const groupColor = ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'][idx % 5];
        
        groupsHTML += `
          <div style="
            margin-bottom: 16px; 
            padding: 16px; 
            background: linear-gradient(135deg, ${groupColor}15, ${groupColor}05);
            border-left: 4px solid ${groupColor};
            border-radius: 10px;
          ">
            <h3 style="margin: 0 0 12px 0; color: ${groupColor}; font-size: 16px; display: flex; align-items: center; gap: 8px;">
              üìÅ ${group.name}
              <span style="font-size: 12px; color: #666; font-weight: normal;">(${group.tabIds.length} –≤–∫–ª–∞–¥–æ–∫)</span>
            </h3>
            <div style="display: flex; flex-direction: column; gap: 8px;">
        `;

        group.tabIds.forEach(tabId => {
          const tabData = tabsData.find(t => t.id === tabId);
          if (tabData) {
            groupsHTML += `
              <div style="
                padding: 10px 12px;
                background: white;
                border-radius: 6px;
                font-size: 13px;
                color: #334155;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                display: flex;
                align-items: center;
                gap: 10px;
              ">
                <img src="https://www.google.com/s2/favicons?domain=${new URL(tabData.url || 'https://google.com').hostname}" 
                     width="16" height="16" 
                     onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2214%22>üåê</text></svg>'"
                     style="flex-shrink: 0;">
                <div style="flex: 1; min-width: 0;">
                  <div style="font-weight: 600; color: ${groupColor}; margin-bottom: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    ${tabData.title}
                  </div>
                  <div style="font-size: 11px; color: #94a3b8; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    ${tabData.url}
                  </div>
                </div>
              </div>
            `;
          }
        });

        groupsHTML += `
            </div>
          </div>
        `;
      });

      groupsHTML += `
        <div style="margin-top: 20px; text-align: center; color: #64748b; font-size: 13px;">
          üí° –ü–æ—Ä–∞–¥–∞: –ó–∞–∫—Ä–∏–π—Ç–µ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω—ñ –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –∫—Ä–∞—â–æ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó
        </div>
      `;

      popup.innerHTML = groupsHTML;
      document.body.appendChild(popup);

      // –ó–∞–∫—Ä–∏—Ç—Ç—è popup
      document.getElementById('close-organize-popup').addEventListener('click', () => {
        popup.remove();
      });

      // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–ª—ñ–∫—É –ø–æ–∑–∞ popup
      popup.addEventListener('click', (e) => {
        if (e.target === popup) {
          popup.remove();
        }
      });
    }

    // ========== VPN —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è (Cloudflare WARP) ==========
    const vpnBtn = document.getElementById('vpn-btn');
    let vpnConnected = false;
    
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å VPN –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
    async function checkVPNStatus() {
      const status = await ipcRenderer.invoke('vpn-status');
      updateVPNButton(status);
    }
    
    // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–≥–ª—è–¥ –∫–Ω–æ–ø–∫–∏
    function updateVPNButton(status) {
      vpnBtn.classList.remove('connected', 'connecting');
      
      if (status.connected) {
        vpnBtn.classList.add('connected');
        vpnBtn.innerHTML = 'üîí VPN –£–≤—ñ–º–∫–Ω–µ–Ω–æ';
        vpnBtn.title = 'VPN –∞–∫—Ç–∏–≤–Ω–∏–π. –ö–ª—ñ–∫–Ω—ñ—Ç—å —â–æ–± –≤–∏–º–∫–Ω—É—Ç–∏';
        vpnConnected = true;
      } else if (status.connecting) {
        vpnBtn.classList.add('connecting');
        vpnBtn.innerHTML = '‚è≥ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...';
        vpnBtn.title = 'VPN –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è...';
      } else {
        vpnBtn.innerHTML = 'üõ°Ô∏è VPN –í–∏–º–∫–Ω–µ–Ω–æ';
        vpnBtn.title = status.error || '–ö–ª—ñ–∫–Ω—ñ—Ç—å —â–æ–± —É–≤—ñ–º–∫–Ω—É—Ç–∏ VPN';
        vpnConnected = false;
      }
    }
    
    // –ü–µ—Ä–µ–º–∏–∫–∞—á VPN
    vpnBtn.addEventListener('click', async () => {
      if (vpnBtn.classList.contains('connecting')) {
        return; // –ù–µ –¥–æ–∑–≤–æ–ª—è—î–º–æ –∫–ª—ñ–∫–∞—Ç–∏ –ø—ñ–¥ —á–∞—Å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
      }
      
      updateVPNButton({ connecting: true });
      
      try {
        const result = await ipcRenderer.invoke('vpn-toggle');
        
        if (result.success) {
          updateVPNButton({ connected: result.connected });
          
          // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
          const message = result.connected ? 
            '‚úÖ VPN —É–≤—ñ–º–∫–Ω–µ–Ω–æ! –í–∞—à–µ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑–∞—Ö–∏—â–µ–Ω–æ' : 
            '‚ö†Ô∏è VPN –≤–∏–º–∫–Ω–µ–Ω–æ';
          
          showNotification(message);
        } else {
          updateVPNButton({ connected: false, error: result.message });
          alert(result.message || '‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è VPN');
        }
      } catch (error) {
        console.error('VPN error:', error);
        updateVPNButton({ connected: false });
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
      }
    });
    
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É —Å–ø–æ–≤—ñ—â–µ–Ω—å
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 120px;
        right: 20px;
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        padding: 16px 20px;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        z-index: 1000000;
        box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
        animation: slideIn 0.3s ease-out;
      `;
      notification.textContent = message;
      
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideIn {
          from { transform: translateX(400px); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(400px); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
    
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
    checkVPNStatus();
    
    // –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç—É—Å (–∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥)
    setInterval(checkVPNStatus, 10000);

    // ========== –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º ==========
    const settingsBtn = document.getElementById('settings-btn');
    
    if (!settingsBtn) {
      console.error('‚ùå –ö–Ω–æ–ø–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞!');
    } else {
      console.log('‚úì –ö–Ω–æ–ø–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –∑–Ω–∞–π–¥–µ–Ω–∞');
    }
    
    // –ì–æ—Ç–æ–≤—ñ —Ç–µ–º–∏
    const themes = {
      light: {
        name: '‚òÄÔ∏è –°–≤—ñ—Ç–ª–∞',
        colors: {
          '--primary-color': '#3b82f6',
          '--primary-dark': '#1e40af',
          '--primary-light': '#dbeafe',
          '--secondary-color': '#10b981',
          '--background': '#ffffff',
          '--toolbar-bg': '#ffffff',
          '--sidebar-bg': 'linear-gradient(180deg, #f0f9ff 0%, #ffffff 100%)',
          '--text-color': '#1e293b',
          '--border-color': '#e3e8f0',
          '--tab-bg': '#bfdbfe',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#dbeafe'
        }
      },
      dark: {
        name: 'üåô –¢–µ–º–Ω–∞',
        colors: {
          '--primary-color': '#60a5fa',
          '--primary-dark': '#3b82f6',
          '--primary-light': '#1e3a8a',
          '--secondary-color': '#34d399',
          '--background': '#1e293b',
          '--toolbar-bg': '#0f172a',
          '--sidebar-bg': 'linear-gradient(180deg, #1e293b 0%, #0f172a 100%)',
          '--text-color': '#f1f5f9',
          '--border-color': '#334155',
          '--tab-bg': '#334155',
          '--tab-active-bg': '#475569',
          '--button-hover': '#334155'
        }
      },
      ocean: {
        name: 'üåä –û–∫–µ–∞–Ω',
        colors: {
          '--primary-color': '#06b6d4',
          '--primary-dark': '#0891b2',
          '--primary-light': '#cffafe',
          '--secondary-color': '#14b8a6',
          '--background': '#ecfeff',
          '--toolbar-bg': '#cffafe',
          '--sidebar-bg': 'linear-gradient(180deg, #cffafe 0%, #ecfeff 100%)',
          '--text-color': '#164e63',
          '--border-color': '#a5f3fc',
          '--tab-bg': '#a5f3fc',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#a5f3fc'
        }
      },
      forest: {
        name: 'üå≤ –õ—ñ—Å',
        colors: {
          '--primary-color': '#10b981',
          '--primary-dark': '#059669',
          '--primary-light': '#d1fae5',
          '--secondary-color': '#22c55e',
          '--background': '#f0fdf4',
          '--toolbar-bg': '#d1fae5',
          '--sidebar-bg': 'linear-gradient(180deg, #d1fae5 0%, #f0fdf4 100%)',
          '--text-color': '#065f46',
          '--border-color': '#bbf7d0',
          '--tab-bg': '#bbf7d0',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#bbf7d0'
        }
      },
      sunset: {
        name: 'üåÖ –ó–∞—Ö—ñ–¥',
        colors: {
          '--primary-color': '#f59e0b',
          '--primary-dark': '#d97706',
          '--primary-light': '#fef3c7',
          '--secondary-color': '#fb923c',
          '--background': '#fffbeb',
          '--toolbar-bg': '#fef3c7',
          '--sidebar-bg': 'linear-gradient(180deg, #fef3c7 0%, #fffbeb 100%)',
          '--text-color': '#78350f',
          '--border-color': '#fde68a',
          '--tab-bg': '#fde68a',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#fde68a'
        }
      },
      purple: {
        name: 'üíú –§—ñ–æ–ª–µ—Ç–æ–≤–∞',
        colors: {
          '--primary-color': '#a855f7',
          '--primary-dark': '#7e22ce',
          '--primary-light': '#f3e8ff',
          '--secondary-color': '#c084fc',
          '--background': '#faf5ff',
          '--toolbar-bg': '#f3e8ff',
          '--sidebar-bg': 'linear-gradient(180deg, #f3e8ff 0%, #faf5ff 100%)',
          '--text-color': '#581c87',
          '--border-color': '#e9d5ff',
          '--tab-bg': '#e9d5ff',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#e9d5ff'
        }
      }
    };

    // –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ç–µ–º—É
    function applyTheme(themeName) {
      const theme = themes[themeName];
      if (!theme) return;

      const root = document.documentElement;
      Object.keys(theme.colors).forEach(key => {
        root.style.setProperty(key, theme.colors[key]);
      });

      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—ñ—Ä
      localStorage.setItem('selectedTheme', themeName);
      showNotification(`‚ú® –¢–µ–º—É "${theme.name}" –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ!`);
    }

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
    if (settingsBtn) {
      settingsBtn.addEventListener('click', () => {
        console.log('üé® –í—ñ–¥–∫—Ä–∏–≤–∞—é –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–º');
        showSettingsPopup();
      });
    } else {
      console.error('‚ùå –ù–µ –º–æ–∂—É –¥–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫ - –∫–Ω–æ–ø–∫–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞');
    }

    function showSettingsPopup() {
      const currentTheme = localStorage.getItem('selectedTheme') || 'light';
      
      const popup = document.createElement('div');
      popup.id = 'settings-popup';
      popup.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--background);
        border: 3px solid var(--primary-color);
        border-radius: 20px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        z-index: 1000001;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        font-family: 'Segoe UI', sans-serif;
      `;

      let themesHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
          <h2 style="margin: 0; color: var(--primary-color); font-size: 24px;">‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–º–∏</h2>
          <button id="close-settings-popup" style="
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
          ">‚úï</button>
        </div>

        <div style="margin-bottom: 20px;">
          <h3 style="color: var(--text-color); margin-bottom: 15px; font-size: 16px;">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É:</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
      `;

      Object.keys(themes).forEach(themeKey => {
        const theme = themes[themeKey];
        const isActive = themeKey === currentTheme;
        
        themesHTML += `
          <button class="theme-option" data-theme="${themeKey}" style="
            padding: 16px;
            border: 3px solid ${isActive ? 'var(--primary-color)' : 'var(--border-color)'};
            background: ${isActive ? 'var(--primary-light)' : 'var(--background)'};
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: ${isActive ? 'bold' : 'normal'};
            color: var(--text-color);
            transition: all 0.2s;
            text-align: center;
          ">
            ${theme.name}
          </button>
        `;
      });

      themesHTML += `
          </div>
        </div>

        <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid var(--border-color); text-align: center; color: var(--text-color); font-size: 14px;">
          üí° –¢–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è
        </div>
      `;

      popup.innerHTML = themesHTML;
      document.body.appendChild(popup);

      // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É —Ç–µ–º–∏
      popup.querySelectorAll('.theme-option').forEach(btn => {
        btn.addEventListener('click', () => {
          const themeName = btn.dataset.theme;
          applyTheme(themeName);
          
          // –û–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω –∫–Ω–æ–ø–æ–∫
          popup.querySelectorAll('.theme-option').forEach(b => {
            b.style.border = '3px solid var(--border-color)';
            b.style.background = 'var(--background)';
            b.style.fontWeight = 'normal';
          });
          btn.style.border = '3px solid var(--primary-color)';
          btn.style.background = 'var(--primary-light)';
          btn.style.fontWeight = 'bold';
        });

        // Hover –µ—Ñ–µ–∫—Ç
        btn.addEventListener('mouseenter', () => {
          if (btn.dataset.theme !== currentTheme) {
            btn.style.transform = 'scale(1.05)';
            btn.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
          }
        });
        btn.addEventListener('mouseleave', () => {
          btn.style.transform = 'scale(1)';
          btn.style.boxShadow = 'none';
        });
      });

      // –ó–∞–∫—Ä–∏—Ç—Ç—è popup
      document.getElementById('close-settings-popup').addEventListener('click', () => {
        popup.remove();
      });

      // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ Escape
      const escHandler = (e) => {
        if (e.key === 'Escape') {
          popup.remove();
          document.removeEventListener('keydown', escHandler);
        }
      };
      document.addEventListener('keydown', escHandler);
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É —Ç–µ–º—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    const savedTheme = localStorage.getItem('selectedTheme');
    if (savedTheme && themes[savedTheme]) {
      applyTheme(savedTheme);
    }

    // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —Å—Ç–∞–Ω (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–≥–æ—Ä–Ω—É—Ç–∞)
    if (isSidebarCollapsed) {
      notesSidebar.classList.add('collapsed');
      toggleSidebarBtn.textContent = '‚ò∞';
      toggleSidebarBtn.title = '–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å';
    } else {
      notesSidebar.classList.add('expanded');
      toggleSidebarBtn.textContent = '‚úï';
      toggleSidebarBtn.title = '–ó–≥–æ—Ä–Ω—É—Ç–∏ –ø–∞–Ω–µ–ª—å';
    }

    // –§—É–Ω–∫—Ü—ñ—è toggle –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—Å—é–¥–∏
    function toggleSidebar() {
      isSidebarCollapsed = !isSidebarCollapsed;
      
      // –û—á–∏—â–∞—î–º–æ inline —Å—Ç–∏–ª—ñ, —â–æ–± CSS –∫–ª–∞—Å–∏ –ø—Ä–∞—Ü—é–≤–∞–ª–∏
      notesSidebar.style.width = '';
      notesSidebar.style.padding = '';
      notesSidebar.style.overflow = '';
      notesSidebar.style.borderLeft = '';
      
      if (isSidebarCollapsed) {
        notesSidebar.classList.remove('expanded');
        notesSidebar.classList.add('collapsed');
      } else {
        notesSidebar.classList.remove('collapsed');
        notesSidebar.classList.add('expanded');
      }
      
      toggleSidebarBtn.textContent = isSidebarCollapsed ? '‚ò∞' : '‚úï';
      toggleSidebarBtn.title = isSidebarCollapsed ? '–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å' : '–ó–≥–æ—Ä–Ω—É—Ç–∏ –ø–∞–Ω–µ–ª—å';
      localStorage.setItem('sidebarCollapsed', isSidebarCollapsed);
      ipcRenderer.send('sidebar-toggled', isSidebarCollapsed);
    }

    // –ö–Ω–æ–ø–∫–∞ –≤ toolbar
    toggleSidebarToolbar.addEventListener('click', toggleSidebar);

    // –û–±—Ä–æ–±–Ω–∏–∫ toggle –ø–∞–Ω–µ–ª—ñ (–∫–Ω–æ–ø–∫–∞ X –≤ –∑–∞–≥–æ–ª–æ–≤–∫—É)
    toggleSidebarBtn.addEventListener('click', toggleSidebar);

    // –ì–∞—Ä—è—á–∞ –∫–ª–∞–≤—ñ—à–∞ Ctrl+B –¥–ª—è toggle –ø–∞–Ω–µ–ª—ñ
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'b') {
        e.preventDefault();
        toggleSidebar();
      }
    });

    // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
    backBtn.addEventListener('click', () => {
      ipcRenderer.send('go-back');
    });

    forwardBtn.addEventListener('click', () => {
      ipcRenderer.send('go-forward');
    });

    reloadBtn.addEventListener('click', () => {
      ipcRenderer.send('reload');
    });

    urlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        ipcRenderer.send('navigate', urlInput.value);
      }
    });

    // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–µ–∫—Å—Ç –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é (–°–ü–Ü–õ–¨–ù–Ü –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    ipcRenderer.on('add-to-notes', (event, text) => {
      addNote(text);
    });

    // –î–æ–¥–∞—î–º–æ –Ω–æ—Ç–∞—Ç–∫—É (—Å–ø—ñ–ª—å–Ω—É –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    function addNote(text) {
      // –í–∏–¥–∞–ª—è—î–º–æ empty state –ø—Ä–∏ –ø–µ—Ä—à—ñ–π –Ω–æ—Ç–∞—Ç—Ü—ñ
      const emptyState = notesList.querySelector('.empty-state');
      if (emptyState) {
        emptyState.remove();
      }

      const noteId = Date.now(); // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –∑–∞–º—ñ—Å—Ç—å —ñ–Ω–¥–µ–∫—Å—É
      collectedNotes.push({ id: noteId, text: text });
      
      const noteItem = document.createElement('div');
      noteItem.className = 'note-item';
      noteItem.dataset.noteId = noteId;
      noteItem.innerHTML = `
        <span>‚Ä¢ ${text}</span>
        <button class="delete-btn" onclick="deleteNote(${noteId})">‚úï</button>
      `;
      
      notesList.appendChild(noteItem);
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage
      localStorage.setItem('sharedNotes', JSON.stringify(collectedNotes));
    }

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–æ—Ç–∞—Ç–∫–∏
    window.deleteNote = function(noteId) {
      const index = collectedNotes.findIndex(note => note.id === noteId);
      if (index !== -1) {
        collectedNotes.splice(index, 1);
        
        // –í–∏–¥–∞–ª—è—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –∑ DOM
        const noteElement = document.querySelector(`[data-note-id="${noteId}"]`);
        if (noteElement) {
          noteElement.remove();
        }
        
        // –ü–æ–∫–∞–∑—É—î–º–æ empty state —è–∫—â–æ –Ω–µ–º–∞—î –Ω–æ—Ç–∞—Ç–æ–∫
        if (collectedNotes.length === 0) {
          notesList.innerHTML = '<div class="empty-state">–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞<br>–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ</div>';
        }
        
        // –û–Ω–æ–≤–ª—é—î–º–æ localStorage
        localStorage.setItem('sharedNotes', JSON.stringify(collectedNotes));
      }
    };

    // –£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –®–Ü (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –°–ü–Ü–õ–¨–ù–Ü –Ω–æ—Ç–∞—Ç–∫–∏)
    summarizeBtn.addEventListener('click', async () => {
      if (collectedNotes.length === 0) {
        alert('–ö–æ–Ω—Å–ø–µ–∫—Ç –ø–æ—Ä–æ–∂–Ω—ñ–π! –í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ.');
        return;
      }

      // –í–∏—Ç—è–≥—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —Ç–µ–∫—Å—Ç –∑ –æ–±'—î–∫—Ç—ñ–≤ –Ω–æ—Ç–∞—Ç–æ–∫
      const notesText = collectedNotes.map(note => note.text || note).join('\n---\n');
      const prompt = `–Ø –∑—ñ–±—Ä–∞–≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏ –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π —ó—Ö, —Å—Ç—Ä—É–∫—Ç—É—Ä—É–π, –≤–∏–¥–∞–ª–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏ —Ç–∞ —Å—Ç–≤–æ—Ä–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é:\n\n${notesText}`;

      summarizeBtn.textContent = '‚è≥ –î—É–º–∞—é...';
      summarizeBtn.disabled = true;

      try {
        const result = await ipcRenderer.invoke('ask-gemini', prompt);
        
        // –ó–∞–º—ñ–Ω—é—î–º–æ —Å–ø–∏—Å–æ–∫ –Ω–∞ —É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è
        notesList.innerHTML = `<div style="padding: 10px; line-height: 1.6; white-space: pre-wrap;">${result}</div>`;
        collectedNotes = [];
      } catch (error) {
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—ñ: ' + error.message);
      } finally {
        summarizeBtn.textContent = '‚ú® –£–∑–∞–≥–∞–ª—å–Ω–∏—Ç–∏ —á–µ—Ä–µ–∑ –®–Ü';
        summarizeBtn.disabled = false;
      }
    });

    // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ (–°–ü–Ü–õ–¨–ù–Ü –Ω–æ—Ç–∞—Ç–∫–∏ –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    clearBtn.addEventListener('click', () => {
      if (collectedNotes.length === 0 && !notesList.querySelector('.empty-state')) {
        return;
      }
      
      if (confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –Ω–æ—Ç–∞—Ç–∫–∏?')) {
        collectedNotes = [];
        notesList.innerHTML = '<div class="empty-state">–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞<br>–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ</div>';
        localStorage.removeItem('sharedNotes');
      }
    });

    // –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω–∏ –º–æ–≤–∏ –ø–µ—Ä–µ–∫–ª–∞–¥—É
    const translationLanguageSelect = document.getElementById('translation-language');
    translationLanguageSelect.addEventListener('change', (e) => {
      const selectedLanguage = e.target.value;
      console.log('üåê –í–∏–±—Ä–∞–Ω–æ –º–æ–≤—É –ø–µ—Ä–µ–∫–ª–∞–¥—É:', selectedLanguage);
      ipcRenderer.send('change-translation-language', selectedLanguage);
    });

    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ (–°–ü–Ü–õ–¨–ù–Ü –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    const savedNotes = localStorage.getItem('sharedNotes');
    if (savedNotes) {
      try {
        const parsed = JSON.parse(savedNotes);
        parsed.forEach(note => {
          const text = note.text || note; // –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É
          const noteId = note.id || Date.now() + Math.random();
          
          if (collectedNotes.length === 0) {
            const emptyState = notesList.querySelector('.empty-state');
            if (emptyState) emptyState.remove();
          }
          
          collectedNotes.push({ id: noteId, text: text });
          
          const noteItem = document.createElement('div');
          noteItem.className = 'note-item';
          noteItem.dataset.noteId = noteId;
          noteItem.innerHTML = `
            <span>‚Ä¢ ${text}</span>
            <button class="delete-btn" onclick="deleteNote(${noteId})">‚úï</button>
          `;
          notesList.appendChild(noteItem);
        });
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ—Ç–∞—Ç–æ–∫:', e);
      }
    }
  </script>
</body>
</html>
