<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';">
  <title>AI Browser</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      background: #1a1b26;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      transition: background 0.3s ease;
      position: relative;
    }

    body.has-wallpaper::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      pointer-events: none;
      z-index: 0;
    }

    body.has-wallpaper .container,
    body.has-wallpaper .toolbar,
    body.has-wallpaper .tabs-bar {
      position: relative;
      z-index: 1;
    }

    .container {
      display: flex;
      height: calc(100vh - 100px); /* 40px tabs + 60px toolbar */
    }

    .main-content {
      flex: 1;
    }

    #notes-sidebar {
      width: 320px;
      background: linear-gradient(to bottom, #24283b 0%, #1a1b26 100%);
      border-left: 1px solid #414868;
      padding: 15px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      overflow-x: visible;
      transition: width 0.3s ease, padding 0.3s ease;
      position: relative;
      box-shadow: -2px 0 8px rgba(59, 130, 246, 0.05);
    }

    /* –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–∞–Ω–µ–ª—å –∑–≥–æ—Ä–Ω—É—Ç–∞ */
    #notes-sidebar.collapsed,
    #notes-sidebar:not(.expanded) {
      width: 0;
      padding: 0;
      border-left: none;
      overflow: hidden;
    }

    #notes-sidebar h3 {
      margin: 0 0 15px 0;
      color: #202124;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    #toggle-sidebar {
      background: linear-gradient(135deg, #f7768e 0%, #db4b68 100%);
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(247, 118, 142, 0.3);
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    #toggle-sidebar:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 16px rgba(247, 118, 142, 0.5);
      background: linear-gradient(135deg, #ff7a93 0%, #f7768e 100%);
    }

    #notes-sidebar h3 {
      margin: 0 0 15px 0;
      color: #c0caf5;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: space-between;
      padding-bottom: 10px;
      border-bottom: 2px solid #414868;
    }
    
    #notes-sidebar h3 .shared-badge {
      font-size: 11px;
      background: #34a853;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: normal;
    }

    .translator-section {
      margin-bottom: 15px;
      padding: 12px;
      background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
      border-radius: 10px;
      border: 1px solid #3b82f6;
    }

    .translator-section h4 {
      margin: 0 0 10px 0;
      color: #1e40af;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .language-select {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #3b82f6;
      border-radius: 8px;
      font-size: 13px;
      background: white;
      color: #1e40af;
      cursor: pointer;
      outline: none;
      font-weight: 500;
    }

    .language-select:hover {
      background: #f0f9ff;
      border-color: #2563eb;
    }

    .language-select:focus {
      border-color: #1e40af;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    #notes-list {
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 15px;
      border: 1px solid #414868;
      background: #2f3549;
      border-radius: 10px;
      padding: 8px;
      color: #c0caf5;
    }

    .note-item {
      border-bottom: 1px solid #414868;
      padding: 10px;
      font-size: 13px;
      line-height: 1.5;
      color: #c0caf5;
      position: relative;
      padding-right: 30px;
      background: #2f3549;
      border-left: 3px solid #f7768e;
      margin-bottom: 6px;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(247, 118, 142, 0.15);
      transition: all 0.2s;
    }
    
    .note-item:hover {
      box-shadow: 0 3px 10px rgba(247, 118, 142, 0.3);
      transform: translateX(2px);
      border-left-color: #ff7a93;
      background: #343a55;
    }

    .note-item:last-child {
      border-bottom: none;
    }

    .note-item .delete-btn {
      position: absolute;
      right: 8px;
      top: 8px;
      background: transparent;
      border: none;
      cursor: pointer;
      color: #dc2626;
      font-size: 16px;
      opacity: 0;
      transition: all 0.2s;
    }

    .note-item:hover .delete-btn {
      opacity: 1;
    }

    #summarize-btn, #clear-btn {
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      margin-bottom: 8px;
    }

    #summarize-btn {
      background: linear-gradient(135deg, #f7768e 0%, #db4b68 100%);
      color: white;
      box-shadow: 0 2px 6px rgba(247, 118, 142, 0.3);
    }

    #summarize-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(247, 118, 142, 0.5);
      background: linear-gradient(135deg, #ff7a93 0%, #f7768e 100%);
    }

    #clear-btn {
      background: #2f3549;
      color: #c0caf5;
      border: 1px solid #414868;
    }

    #clear-btn:hover {
      background: #414868;
      border-color: #565f89;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #80868b;
      font-size: 13px;
    }

    .toolbar {
      height: 60px;
      background: #24283b;
      display: flex;
      align-items: center;
      padding: 0 10px;
      gap: 10px;
      border-bottom: 1px solid #414868;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      -webkit-app-region: no-drag;
    }

    .nav-button {
      width: 34px;
      height: 34px;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #c0caf5;
      transition: all 0.15s;
      -webkit-app-region: no-drag;
    }

    .nav-button:hover {
      background: rgba(192, 202, 245, 0.1);
    }

    .nav-button:active {
      transform: scale(0.95);
    }

    .organize-btn {
      height: 34px;
      padding: 0 14px;
      border: none;
      background: rgba(16, 185, 129, 0.15);
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: #10b981;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.15s;
    }

    .organize-btn:hover {
      background: rgba(16, 185, 129, 0.25);
    }

    .organize-btn:active {
      transform: scale(0.95);
    }

    .address-bar {
      flex: 1;
      height: 36px;
      padding: 0 14px;
      border: 1px solid #414868;
      border-radius: 6px;
      font-size: 13px;
      outline: none;
      background: #24283b;
      color: #c0caf5;
      transition: all 0.15s;
    }

    .address-bar:focus {
      border-color: #f7768e;
      background: #2f3549;
    }

    .address-bar::placeholder {
      color: #565f89;
    }
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background: #ffffff;
    }

    /* –†–æ–∑—É–º–Ω–∏–π –ø–æ—à—É–∫ */
    #smart-search-box {
      display: none;
      position: absolute;
      top: 70px;
      right: 340px;
      width: 350px;
      background: white;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      border-radius: 12px;
      z-index: 10000;
      border: 2px solid #667eea;
    }

    #smart-search-box h4 {
      margin: 0 0 15px 0;
      color: #333;
      font-size: 18px;
    }

    #search-query {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 12px;
    }

    #search-query:focus {
      outline: none;
      border-color: #667eea;
    }

    #btn-smart-find {
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    #btn-smart-find:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    #btn-smart-find:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #search-status {
      margin-top: 12px;
      font-size: 13px;
      color: #666;
      min-height: 20px;
      text-align: center;
    }

    .smart-search-btn {
      background: transparent;
      color: #c0caf5;
      border: none;
      width: 34px;
      height: 34px;
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }

    .smart-search-btn:hover {
      background: rgba(192, 202, 245, 0.1);
    }

    .smart-search-btn:active {
      transform: scale(0.95);
    }

    /* –ü–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ (–∑ –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ñ–∫–Ω–∞, —è–∫ Chrome) */
    .tabs-bar {
      height: 40px;
      background: #1f2335;
      display: flex;
      align-items: flex-end;
      padding: 0;
      border-bottom: 1px solid #414868;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-app-region: drag;
      position: relative;
    }

    .menu-section {
      display: flex;
      align-items: center;
      padding: 0 8px;
      -webkit-app-region: no-drag;
      gap: 8px;
      height: 40px;
    }

    .menu-btn {
      width: 32px;
      height: 32px;
      background: transparent;
      border: none;
      color: #c0caf5;
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s;
    }

    .menu-btn:hover {
      background: rgba(192, 202, 245, 0.1);
    }

    /* –í–∏–ø–∞–¥–∞—é—á–µ –º–µ–Ω—é */
    .dropdown-menu {
      position: fixed;
      top: 48px;
      left: 8px;
      width: 320px;
      background: #1f2335;
      border: 1px solid #414868;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 999999;
      overflow: hidden;
      -webkit-app-region: no-drag;
      overflow-y: auto;
      max-height: calc(100vh - 60px);
    }

    .dropdown-menu.active {
      display: block;
    }

    .menu-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      color: #c0caf5;
      cursor: pointer;
      transition: background 0.15s;
      font-size: 14px;
      border: none;
      background: transparent;
      width: 100%;
      text-align: left;
    }

    .menu-item:hover {
      background: rgba(192, 202, 245, 0.1);
    }

    .menu-item .label {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .menu-item .shortcut {
      font-size: 12px;
      color: #565f89;
      font-family: monospace;
    }

    .menu-item.has-submenu::after {
      content: '‚Ä∫';
      font-size: 18px;
      color: #565f89;
    }

    .menu-separator {
      height: 1px;
      background: #2f3549;
      margin: 4px 0;
    }

    .menu-header {
      padding: 12px 16px 8px;
      color: #565f89;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .zoom-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
    }

    .zoom-btn {
      width: 28px;
      height: 28px;
      background: transparent;
      border: 1px solid #414868;
      border-radius: 6px;
      color: #c0caf5;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .zoom-btn:hover {
      background: rgba(192, 202, 245, 0.1);
      border-color: #565f89;
    }

    .zoom-value {
      flex: 1;
      text-align: center;
      color: #c0caf5;
      font-size: 14px;
      font-weight: 500;
    }

    /* ============ –ù–û–í–ê –ü–ê–ù–ï–õ–¨ –ù–ê–õ–ê–®–¢–£–í–ê–ù–¨ ============ */
    :root {
      --theme-bg: #1a1b26;
      --theme-accent: #3b82f6;
      --theme-text: #c0caf5;
      --theme-surface: #24283b;
      --theme-border: #414868;
    }

    .side-panel {
      position: fixed;
      top: 0;
      right: -380px;
      width: 350px;
      height: 100vh;
      background: var(--theme-surface);
      box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
      transition: right 0.3s ease-in-out;
      z-index: 2147483647;
      display: flex;
      flex-direction: column;
      -webkit-app-region: no-drag;
    }

    .side-panel.open {
      right: 0;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--theme-border);
    }

    .panel-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 500;
      color: var(--theme-text);
    }

    .close-panel-btn {
      width: 32px;
      height: 32px;
      background: transparent;
      border: none;
      color: var(--theme-text);
      cursor: pointer;
      border-radius: 50%;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s;
      -webkit-app-region: no-drag;
    }

    .close-panel-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    /* Preview Box */
    .preview-box {
      background: var(--theme-bg);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      border: 2px solid var(--theme-accent);
      transition: all 0.3s;
    }

    .preview-mini-browser {
      background: var(--theme-surface);
      border-radius: 8px;
      overflow: hidden;
    }

    .preview-mini-tabs {
      height: 24px;
      background: rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      padding: 0 8px;
    }

    .preview-mini-tab {
      height: 18px;
      width: 70px;
      background: var(--theme-accent);
      border-radius: 4px 4px 0 0;
    }

    .preview-mini-toolbar {
      height: 28px;
      background: var(--theme-surface);
      display: flex;
      align-items: center;
      padding: 0 10px;
      gap: 6px;
    }

    .preview-mini-btn {
      width: 10px;
      height: 10px;
      background: var(--theme-border);
      border-radius: 50%;
    }

    .preview-mini-url {
      flex: 1;
      height: 16px;
      background: var(--theme-bg);
      border-radius: 4px;
      margin-left: 8px;
    }

    .preview-mini-content {
      height: 50px;
      background: var(--theme-bg);
    }

    /* Mode Switch */
    .mode-switch {
      display: flex;
      background: var(--theme-bg);
      border-radius: 10px;
      padding: 4px;
      margin-bottom: 24px;
    }

    .mode-btn {
      flex: 1;
      padding: 12px;
      background: transparent;
      border: none;
      color: #666;
      cursor: pointer;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      -webkit-app-region: no-drag;
    }

    .mode-btn.active {
      background: var(--theme-accent);
      color: white;
    }

    .mode-btn:hover:not(.active) {
      color: var(--theme-text);
      background: rgba(255, 255, 255, 0.05);
    }

    /* Section Title */
    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: #666;
      margin: 0 0 16px 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Color Grid - –°–ü–õ–Ü–¢ –ö–†–£–ñ–ï–ß–ö–ò */
    .color-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }

    .color-option {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: 3px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      -webkit-app-region: no-drag;
    }

    .color-option:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    }

    .color-option.active {
      border-color: white;
      box-shadow: 0 0 0 3px var(--theme-accent), 0 4px 15px rgba(0, 0, 0, 0.4);
    }

    .color-option.active::after {
      content: '‚úì';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 20px;
      font-weight: bold;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    .color-custom {
      background: conic-gradient(red, yellow, lime, aqua, blue, magenta, red) !important;
    }

    /* Settings Toggle */
    .settings-group {
      margin-bottom: 24px;
    }

    .settings-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .settings-item span {
      color: var(--theme-text);
      font-size: 14px;
    }

    .toggle-switch {
      width: 48px;
      height: 26px;
      background: var(--theme-border);
      border-radius: 13px;
      cursor: pointer;
      position: relative;
      transition: background 0.3s;
      -webkit-app-region: no-drag;
    }

    .toggle-switch.active {
      background: var(--theme-accent);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch.active::after {
      transform: translateX(22px);
    }

    /* Wallpaper Section */
    .wallpaper-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .wallpaper-card {
      height: 100px;
      border-radius: 12px;
      background-size: cover;
      background-position: center;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
      -webkit-app-region: no-drag;
    }

    .wallpaper-card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .wallpaper-card.active {
      border-color: var(--theme-accent);
      box-shadow: 0 0 0 2px var(--theme-accent);
    }

    .wallpaper-card.active::after {
      content: '‚úì';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      background: var(--theme-accent);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
    }

    .wallpaper-card.upload-card {
      background: var(--theme-bg);
      border: 2px dashed var(--theme-border);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 8px;
    }

    .wallpaper-card.upload-card:hover {
      border-color: var(--theme-accent);
      background: rgba(59, 130, 246, 0.1);
    }

    .upload-icon {
      font-size: 32px;
      opacity: 0.6;
    }

    .upload-text {
      font-size: 12px;
      opacity: 0.6;
    }

    .wallpaper-actions {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
    }

    .wallpaper-btn {
      flex: 1;
      padding: 10px 16px;
      border: 1px solid var(--theme-border);
      background: transparent;
      color: var(--theme-text);
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      -webkit-app-region: no-drag;
    }

    .wallpaper-btn:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--theme-accent);
    }

    .wallpaper-btn.primary {
      background: var(--theme-accent);
      border-color: var(--theme-accent);
      color: white;
    }

    .wallpaper-btn.primary:hover {
      opacity: 0.9;
    }

    /* Overlay */
    .panel-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2147483646;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .panel-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .logo {
      font-weight: 700;
      font-size: 15px;
      color: #f7768e;
      letter-spacing: -0.5px;
      user-select: none;
    }

    .tabs-container {
      display: flex;
      align-items: flex-end;
      flex: 1;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-app-region: no-drag;
      padding: 0 5px;
    }

    .tabs-bar::-webkit-scrollbar {
      height: 3px;
    }

    .tabs-bar::-webkit-scrollbar-thumb {
      background: #565f89;
      border-radius: 2px;
    }

    /* –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–∫–Ω–æ–º (—ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ –≤ –ø–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫) */
    .window-controls {
      display: flex;
      height: 40px;
      align-items: center;
      -webkit-app-region: no-drag;
      margin-left: auto;
    }

    .window-btn {
      width: 46px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      color: #c0caf5;
      cursor: pointer;
      transition: all 0.15s;
      -webkit-app-region: no-drag;
    }

    .window-btn:hover {
      background: rgba(247, 118, 142, 0.2);
    }

    .window-btn.close:hover {
      background: #dc2626;
      color: white;
    }

    .tab {
      min-width: 150px;
      max-width: 240px;
      height: 34px;
      background: #2f3549;
      border-radius: 12px 12px 0 0;
      margin-right: 2px;
      padding: 0 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      border: 1px solid #414868;
      border-bottom: none;
      transition: all 0.15s;
      position: relative;
      -webkit-app-region: no-drag;
    }

    .tab:hover {
      background: #343a55;
    }

    .tab.active {
      background: #f7768e;
      height: 36px;
      border-color: #f7768e;
      z-index: 1;
      box-shadow: 0 -2px 8px rgba(247, 118, 142, 0.3);
    }

    .tab-favicon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .tab-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 13px;
      color: #c0caf5;
    }

    .tab.active .tab-title {
      font-weight: 600;
      color: white;
    }

    .tab-close {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      flex-shrink: 0;
      opacity: 0;
      transition: opacity 0.15s;
    }

    .tab:hover .tab-close {
      opacity: 1;
    }

    .tab-close:hover {
      background: rgba(247, 118, 142, 0.3);
    }

    .tab.active .tab-close {
      opacity: 1;
    }

    .new-tab-btn {
      width: 32px;
      height: 32px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: #c0caf5;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      flex-shrink: 0;
      -webkit-app-region: no-drag;
    }

    .new-tab-btn:hover {
      background: rgba(247, 118, 142, 0.2);
    }
  </style>
</head>
<body>
  <!-- –ü–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ –∑ –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ñ–∫–Ω–∞ -->
  <div class="tabs-bar" id="tabs-bar">
    <div class="menu-section">
      <button class="menu-btn" id="menu-btn" title="–ú–µ–Ω—é">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M1 2h14v2H1V2zm0 5h14v2H1V7zm0 5h14v2H1v-2z"/>
        </svg>
      </button>
      <span class="logo">BrowserX</span>
    </div>
    <div class="tabs-container">
      <div class="tab active" data-tab-id="1">
        <img class="tab-favicon" src="https://www.google.com/favicon.ico" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2214%22>üåê</text></svg>'">
        <span class="tab-title">–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞</span>
        <span class="tab-close">‚úï</span>
      </div>
      <button class="new-tab-btn" id="new-tab-btn" title="–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞ (Ctrl+T)">+</button>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–∫–Ω–æ–º -->
    <div class="window-controls">
      <button class="window-btn" id="minimize-btn" title="–ó–≥–æ—Ä–Ω—É—Ç–∏">
        <svg width="10" height="1" viewBox="0 0 10 1"><path fill="currentColor" d="M0 0h10v1H0z"/></svg>
      </button>
      <button class="window-btn" id="maximize-btn" title="–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏">
        <svg width="10" height="10" viewBox="0 0 10 10"><path fill="currentColor" d="M0 0v10h10V0H0zm1 1h8v8H1V1z"/></svg>
      </button>
      <button class="window-btn close" id="close-btn" title="–ó–∞–∫—Ä–∏—Ç–∏">
        <svg width="10" height="10" viewBox="0 0 10 10"><path fill="currentColor" d="M0 0l1-1 4 4 4-4 1 1-4 4 4 4-1 1-4-4-4 4-1-1 4-4z"/></svg>
      </button>
    </div>
  </div>

  <div class="toolbar">
    <button class="nav-button" id="back" title="–ù–∞–∑–∞–¥">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10 14L4 8l6-6"/>
      </svg>
    </button>
    <button class="nav-button" id="forward" title="–í–ø–µ—Ä–µ–¥">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 14l6-6-6-6"/>
      </svg>
    </button>
    <button class="nav-button" id="reload" title="–û–Ω–æ–≤–∏—Ç–∏">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
        <path d="M13 8c0-2.76-2.24-5-5-5-1.5 0-2.85.66-3.77 1.7L2 2v5h5L4.5 4.5C5.2 3.6 6.5 3 8 3c2.21 0 4 1.79 4 4s-1.79 4-4 4c-1.11 0-2.11-.45-2.83-1.17L3.76 11.24C4.82 12.3 6.33 13 8 13c2.76 0 5-2.24 5-5z"/>
      </svg>
    </button>
    <input type="text" class="address-bar" id="url" placeholder="–ü–æ—à—É–∫ –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É">
    <button class="organize-btn" id="organize-tabs-btn" title="AI –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –≤–∫–ª–∞–¥–æ–∫">–û—Ä–≥–∞–Ω—ñ–∑—É–≤–∞—Ç–∏</button>
    <!-- Settings button removed (Simple Settings UI deprecated) -->
    <button class="smart-search-btn" id="theme-settings-btn" title="–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≤–∏–≥–ª—è–¥" style="background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 50%;">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="white">
        <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 13A6 6 0 0 1 8 2a6 6 0 0 1 0 12z"/>
        <circle cx="8" cy="8" r="3" fill="white"/>
      </svg>
    </button>
    <button class="smart-search-btn" id="toggle-sidebar-toolbar" title="–ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç (Ctrl+B)">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
        <path d="M3 2h10c.55 0 1 .45 1 1v10c0 .55-.45 1-1 1H3c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1zm0 2v8h10V4H3zm2 2h6v1H5V6zm0 2h6v1H5V8zm0 2h4v1H5v-1z"/>
      </svg>
    </button>
  </div>

  <!-- –í–∏–ø–∞–¥–∞—é—á–µ –º–µ–Ω—é -->
  <div class="dropdown-menu" id="dropdown-menu">
    <button class="menu-item">
      <span class="label">–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞</span>
      <span class="shortcut">CTRL + T</span>
    </button>
    <button class="menu-item">
      <span class="label">–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞ –≤ –æ—Å—Ç—Ä–æ–≤—ñ –≤–∫–ª–∞–¥–æ–∫</span>
      <span class="shortcut">ALT + T</span>
    </button>
    <button class="menu-item">
      <span class="label">–ù–æ–≤–µ –≤—ñ–∫–Ω–æ</span>
      <span class="shortcut">CTRL + N</span>
    </button>
    <button class="menu-item">
      <span class="label">–ù–æ–≤–µ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–µ –≤—ñ–∫–Ω–æ</span>
      <span class="shortcut">CTRL + SHIFT + N</span>
    </button>

    <div class="menu-separator"></div>

    <button class="menu-item has-submenu">
      <span class="label">–°—Ç–æ—Ä—ñ–Ω–∫–∞</span>
    </button>

    <div class="menu-separator"></div>

    <div class="zoom-controls">
      <button class="zoom-btn" id="zoom-out">‚àí</button>
      <div class="zoom-value" id="zoom-value">100%</div>
      <button class="zoom-btn" id="zoom-in">+</button>
      <button class="zoom-btn" id="zoom-reset" title="–°–∫–∏–Ω—É—Ç–∏ –º–∞—Å—à—Ç–∞–±">‚ü≤</button>
      <button class="zoom-btn" id="fullscreen" title="–ü–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–∏–π —Ä–µ–∂–∏–º">‚õ∂</button>
    </div>

    <div class="menu-separator"></div>

    <button class="menu-item">
      <span class="label">–ú–∞—Å—à—Ç–∞–±</span>
    </button>
    <button class="menu-item">
      <span class="label">–ó–Ω–∞–π—Ç–∏...</span>
      <span class="shortcut">CTRL + F</span>
    </button>
    <button class="menu-item">
      <span class="label">–í–∫–ª–∞–¥–∫–∏ –ø–æ—à—É–∫—É</span>
      <span class="shortcut">CTRL + SPACE</span>
    </button>
    <button class="menu-item">
      <span class="label">–ó–Ω—ñ–º–æ–∫</span>
      <span class="shortcut">CTRL + SHIFT + 5</span>
    </button>

    <div class="menu-separator"></div>

    <button class="menu-item has-submenu">
      <span class="label">–ñ—É—Ä–Ω–∞–ª</span>
    </button>
    <button class="menu-item">
      <span class="label">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</span>
      <span class="shortcut">CTRL + J</span>
    </button>
    <button class="menu-item has-submenu">
      <span class="label">–ó–∞–∫–ª–∞–¥–∫–∏</span>
    </button>
    <button class="menu-item has-submenu">
      <span class="label">–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è</span>
    </button>
    <button class="menu-item has-submenu">
      <span class="label">–ù–æ–≤–∏–Ω–∏</span>
    </button>
    <button class="menu-item">
      <span class="label">Pinboards</span>
    </button>
    <button class="menu-item">
      <span class="label">–£–≤—ñ–π—Ç–∏ –≤ –û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å Opera...</span>
    </button>

    <div class="menu-separator"></div>

    <button class="menu-item has-submenu">
      <span class="label">–†–æ–∑—Ä–æ–±–Ω–∏–∫</span>
    </button>

    <div class="menu-separator"></div>

    <button class="menu-item" id="customize-menu">
      <span class="label">–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≤–∏–≥–ª—è–¥</span>
      <span class="shortcut">CTRL + SHIFT + Y</span>
    </button>
    <button class="menu-item">
      <span class="label">–ü–∞—Ä–∞–º–µ—Ç—Ä–∏</span>
      <span class="shortcut">ALT + P</span>
    </button>
    <button class="menu-item has-submenu">
      <span class="label">–î–æ–≤—ñ–¥–∫–∞</span>
    </button>
    <button class="menu-item has-submenu">
      <span class="label">–ü—Ä–æ—Ñ—ñ–ª—ñ</span>
    </button>
    <button class="menu-item">
      <span class="label">–û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è...</span>
    </button>

    <div class="menu-separator"></div>

    <button class="menu-item" id="exit-browser">
      <span class="label">–í–∏–π—Ç–∏</span>
    </button>
  </div>

  <!-- Overlay –¥–ª—è –ø–∞–Ω–µ–ª—ñ -->
  <div class="panel-overlay" id="panel-overlay"></div>

  <!-- –ù–û–í–ê –ü–∞–Ω–µ–ª—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å -->
  <div id="theme-panel" class="side-panel">
    <div class="panel-header">
      <h3>–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≤–∏–≥–ª—è–¥</h3>
      <button class="close-panel-btn" id="close-panel-btn">‚úï</button>
    </div>

    <div class="panel-content">
      <!-- Preview Box -->
      <div class="preview-box" id="preview-box">
        <div class="preview-mini-browser">
          <div class="preview-mini-tabs">
            <div class="preview-mini-tab"></div>
          </div>
          <div class="preview-mini-toolbar">
            <div class="preview-mini-btn"></div>
            <div class="preview-mini-btn"></div>
            <div class="preview-mini-btn"></div>
            <div class="preview-mini-url"></div>
          </div>
          <div class="preview-mini-content"></div>
        </div>
      </div>

      <!-- Mode Switch -->
      <div class="mode-switch">
        <button class="mode-btn" data-mode="light">‚òÄÔ∏è –°–≤—ñ—Ç–ª–∞</button>
        <button class="mode-btn active" data-mode="dark">üåô –¢–µ–º–Ω–∞</button>
        <button class="mode-btn" data-mode="system">üíª –°–∏—Å—Ç–µ–º–∞</button>
      </div>

      <!-- Color Grid - –°–ü–õ–Ü–¢ –ö–†–£–ñ–ï–ß–ö–ò -->
      <h4 class="section-title">–ö–æ–ª—ñ—Ä–Ω–∞ –≥–∞–º–∞</h4>
      <div class="color-grid" id="color-grid">
        <!-- –°–∏–Ω—ñ–π + –±—ñ–ª–∏–π -->
        <button class="color-option active" data-bg="#1a1b26" data-accent="#3b82f6" style="background: linear-gradient(135deg, #3b82f6 50%, #1e3a5f 50%);"></button>
        <!-- –ë—ñ—Ä—é–∑–æ–≤–∏–π -->
        <button class="color-option" data-bg="#1a2e2e" data-accent="#14b8a6" style="background: linear-gradient(135deg, #14b8a6 50%, #134e4a 50%);"></button>
        <!-- –ó–µ–ª–µ–Ω–∏–π -->
        <button class="color-option" data-bg="#1a2e1a" data-accent="#22c55e" style="background: linear-gradient(135deg, #22c55e 50%, #166534 50%);"></button>
        <!-- –§—ñ–æ–ª–µ—Ç–æ–≤–∏–π -->
        <button class="color-option" data-bg="#1e1a2e" data-accent="#8b5cf6" style="background: linear-gradient(135deg, #8b5cf6 50%, #4c1d95 50%);"></button>
        
        <!-- –†–æ–∂–µ–≤–∏–π -->
        <button class="color-option" data-bg="#2e1a2a" data-accent="#ec4899" style="background: linear-gradient(135deg, #ec4899 50%, #831843 50%);"></button>
        <!-- –ß–µ—Ä–≤–æ–Ω–∏–π -->
        <button class="color-option" data-bg="#2e1a1a" data-accent="#ef4444" style="background: linear-gradient(135deg, #ef4444 50%, #7f1d1d 50%);"></button>
        <!-- –û—Ä–∞–Ω–∂–µ–≤–∏–π -->
        <button class="color-option" data-bg="#2e2a1a" data-accent="#f97316" style="background: linear-gradient(135deg, #f97316 50%, #7c2d12 50%);"></button>
        <!-- –ñ–æ–≤—Ç–∏–π -->
        <button class="color-option" data-bg="#2e2e1a" data-accent="#eab308" style="background: linear-gradient(135deg, #eab308 50%, #713f12 50%);"></button>
        
        <!-- –°—ñ—Ä–∏–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π -->
        <button class="color-option" data-bg="#1f1f1f" data-accent="#6b7280" style="background: linear-gradient(135deg, #6b7280 50%, #374151 50%);"></button>
        <!-- –õ–∞–π–º–æ–≤–∏–π -->
        <button class="color-option" data-bg="#1a2e1a" data-accent="#84cc16" style="background: linear-gradient(135deg, #84cc16 50%, #3f6212 50%);"></button>
        <!-- –ë–ª–∞–∫–∏—Ç–Ω–∏–π -->
        <button class="color-option" data-bg="#1a2a2e" data-accent="#06b6d4" style="background: linear-gradient(135deg, #06b6d4 50%, #155e75 50%);"></button>
        <!-- –ö–∞—Å—Ç–æ–º–Ω–∏–π -->
        <button class="color-option color-custom" data-bg="custom" data-accent="custom"></button>
      </div>

      <!-- Wallpapers Section -->
      <h4 class="section-title">–®–ø–∞–ª–µ—Ä–∏</h4>
      <div class="wallpaper-grid" id="wallpaper-grid">
        <!-- No wallpaper -->
        <div class="wallpaper-card active" data-wallpaper="none" style="background: linear-gradient(135deg, var(--theme-bg), var(--theme-surface));">
          <div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 32px; opacity: 0.3;">‚àÖ</div>
        </div>
        
        <!-- Upload custom -->
        <div class="wallpaper-card upload-card" id="upload-wallpaper">
          <div class="upload-icon">üì∑</div>
          <div class="upload-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</div>
        </div>

        <!-- Preset wallpapers -->
        <div class="wallpaper-card" data-wallpaper="abstract1" style="background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
        <div class="wallpaper-card" data-wallpaper="abstract2" style="background-image: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
        <div class="wallpaper-card" data-wallpaper="abstract3" style="background-image: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
        <div class="wallpaper-card" data-wallpaper="abstract4" style="background-image: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
        <div class="wallpaper-card" data-wallpaper="abstract5" style="background-image: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
        <div class="wallpaper-card" data-wallpaper="abstract6" style="background-image: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></div>
      </div>

      <div class="wallpaper-actions">
        <button class="wallpaper-btn" id="clear-wallpaper">–û—á–∏—Å—Ç–∏—Ç–∏ —à–ø–∞–ª–µ—Ä–∏</button>
        <button class="wallpaper-btn primary" id="upload-wallpaper-btn">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤—É</button>
      </div>
      <input type="file" id="wallpaper-file-input" accept="image/*" style="display: none;">

      <!-- Settings Group -->
      <div class="settings-group">
        <h4 class="section-title">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h4>
        <div class="settings-item">
          <span>–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É "–ì–æ–ª–æ–≤–Ω–∞"</span>
          <div class="toggle-switch active" id="home-btn-toggle"></div>
        </div>
        <div class="settings-item">
          <span>–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø–∞–Ω–µ–ª—å –∑–∞–∫–ª–∞–¥–æ–∫</span>
          <div class="toggle-switch" id="bookmarks-toggle"></div>
        </div>
        <div class="settings-item">
          <span>–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —è—Ä–ª–∏–∫–∏ –Ω–∞ –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ</span>
          <div class="toggle-switch active" id="shortcuts-toggle"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="main-content"></div>
    
    <div id="notes-sidebar" class="collapsed" style="width: 0; padding: 0; overflow: hidden; border-left: none;">
      <h3>
        <span>üìù –ú—ñ–π –ö–æ–Ω—Å–ø–µ–∫—Ç</span>
        <button id="toggle-sidebar" title="–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å">‚ò∞</button>
      </h3>
      
      <div id="notes-list">
        <div class="empty-state">–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞<br>–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ</div>
      </div>

      <button id="summarize-btn">‚ú® –£–∑–∞–≥–∞–ª—å–Ω–∏—Ç–∏ —á–µ—Ä–µ–∑ –®–Ü</button>
      <button id="clear-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
    </div>
  </div>

  <script>
    console.log('üöÄ JavaScript –ø–æ—á–∏–Ω–∞—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è');
    
    try {
      const { ipcRenderer } = require('electron');
      console.log('‚úÖ IPC Renderer –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –≤ main window');
      
      // ========== –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–∫–Ω–æ–º ==========
      const minimizeBtn = document.getElementById('minimize-btn');
      const maximizeBtn = document.getElementById('maximize-btn');
      const closeBtn = document.getElementById('close-btn');
      
      if (minimizeBtn) {
        minimizeBtn.addEventListener('click', () => {
          console.log('üîΩ –ó–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤—ñ–∫–Ω–∞');
          ipcRenderer.send('window-minimize');
        });
      }
      
      if (maximizeBtn) {
        maximizeBtn.addEventListener('click', () => {
          console.log('üîº –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤—ñ–∫–Ω–∞');
          ipcRenderer.send('window-maximize');
        });
      }
      
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          console.log('‚ùå –ó–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–∫–Ω–∞');
          ipcRenderer.send('window-close');
        });
      }
      
      const backBtn = document.getElementById('back');
      const forwardBtn = document.getElementById('forward');
      const reloadBtn = document.getElementById('reload');
      const urlInput = document.getElementById('url');
      const notesList = document.getElementById('notes-list');
      const summarizeBtn = document.getElementById('summarize-btn');
      const clearBtn = document.getElementById('clear-btn');
      
      // Toggle –±–æ–∫–æ–≤–æ—ó –ø–∞–Ω–µ–ª—ñ
      const notesSidebar = document.getElementById('notes-sidebar');
      const toggleSidebarBtn = document.getElementById('toggle-sidebar');
      const toggleSidebarToolbar = document.getElementById('toggle-sidebar-toolbar');
      const menuBtn = document.getElementById('menu-btn');
      
      // –í–∫–ª–∞–¥–∫–∏
      const tabsBar = document.getElementById('tabs-bar');
      const tabsContainer = tabsBar.querySelector('.tabs-container');
      const newTabBtn = document.getElementById('new-tab-btn');
      
      let collectedNotes = [];
      
      // –í–ò–î–ê–õ–Ø–Ñ–ú–û —Å—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ localStorage, —â–æ–± –ø–∞–Ω–µ–ª—å –∑–∞–≤–∂–¥–∏ –±—É–ª–∞ –∑–≥–æ—Ä–Ω—É—Ç–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
      localStorage.removeItem('sidebarCollapsed');
      
      let isSidebarCollapsed = true; // –ó–∞–≤–∂–¥–∏ –∑–≥–æ—Ä–Ω—É—Ç–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
      let currentTabId = 1; // –ü–æ—Ç–æ—á–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞ –≤–∫–ª–∞–¥–∫–∞

      // ========== –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª–∞–¥–æ–∫ ==========
      
      // –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –≤–∫–ª–∞–¥–∫—É
      async function createTab(url = 'https://www.google.com') {
      const result = await ipcRenderer.invoke('create-tab', url);
      
      // –°—Ç–≤–æ—Ä—é—î–º–æ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
      const tabElement = document.createElement('div');
      tabElement.className = 'tab';
      tabElement.dataset.tabId = result.id;
      
      tabElement.innerHTML = `
        <img class="tab-favicon" src="https://www.google.com/favicon.ico" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2214%22>üåê</text></svg>'">
        <span class="tab-title">${result.title}</span>
        <span class="tab-close">‚úï</span>
      `;
      
      // –î–æ–¥–∞—î–º–æ –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ—é "+" –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∫–ª–∞–¥–æ–∫
      tabsContainer.insertBefore(tabElement, newTabBtn);
      
      // –ü–µ—Ä–µ–º–∏–∫–∞—î–º–æ—Å—å –Ω–∞ –Ω–æ–≤—É –≤–∫–ª–∞–¥–∫—É
      switchTab(result.id);
      
      return result.id;
      }
      
      // –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É
      function switchTab(tabId) {
        // –ó–Ω—ñ–º–∞—î–º–æ –∫–ª–∞—Å active –∑ —É—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab').forEach(tab => {
          tab.classList.remove('active');
          // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –∫–æ–ª—ñ—Ä –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏
          let savedTheme = localStorage.getItem('browserTheme') || 'frutti';
          const tabColor = getThemeColors(savedTheme).tab;
          tab.style.background = tabColor;
        });
        
        // –î–æ–¥–∞—î–º–æ active –¥–æ –≤–∏–±—Ä–∞–Ω–æ—ó
        const targetTab = document.querySelector(`[data-tab-id="${tabId}"]`);
        if (targetTab) {
          targetTab.classList.add('active');
          // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –∫–æ–ª—ñ—Ä –∞–∫—Ç–∏–≤–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏
          let savedTheme2 = localStorage.getItem('browserTheme') || 'frutti';
          const tabActiveColor = getThemeColors(savedTheme2).tabActive;
          targetTab.style.background = tabActiveColor;
          
          currentTabId = tabId;
          ipcRenderer.send('switch-tab', tabId);
        }
      }

      function getThemeColors(themeId) {
        const themes = {
          frutti: {
            primary: '#f7768e',
            tab: '#2f3549',
            tabActive: '#f7768e'
          },
          purple: {
            primary: '#bb9af7',
            tab: '#2f3549',
            tabActive: '#bb9af7'
          },
          vaporwave: {
            primary: '#2ac3de',
            tab: '#2f3549',
            tabActive: '#2ac3de'
          }
        };
        return themes[themeId] || themes.frutti;
      }
      
      // –ó–∞–∫—Ä–∏—Ç–∏ –≤–∫–ª–∞–¥–∫—É
      function closeTab(tabId) {
        const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
        if (tabElement) {
          tabElement.remove();
        }
        ipcRenderer.send('close-tab', tabId);
      }
      
      // –û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤–∫–ª–∞–¥–∫–∏ (–∑–∞–≥–æ–ª–æ–≤–æ–∫, favicon)
      ipcRenderer.on('update-tab-info', (event, tabId, title, url) => {
        const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
        if (tabElement) {
          const titleElement = tabElement.querySelector('.tab-title');
          const faviconElement = tabElement.querySelector('.tab-favicon');
          
          if (titleElement) titleElement.textContent = title || '–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞';
          
          if (faviconElement && url) {
            const faviconUrl = new URL(url).origin + '/favicon.ico';
            faviconElement.src = faviconUrl;
          }
        }
      });
      
      // –û–Ω–æ–≤–∏—Ç–∏ URL bar
      ipcRenderer.on('update-url-bar', (event, url) => {
        urlInput.value = url;
      });
      
      // –Ø–∫—â–æ –≤—Å—ñ –≤–∫–ª–∞–¥–∫–∏ –∑–∞–∫—Ä–∏—Ç–æ, —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É
      ipcRenderer.on('create-default-tab', () => {
      createTab();
    });
    
    // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
    if (tabsBar) {
      tabsBar.addEventListener('click', (e) => {
      const tab = e.target.closest('.tab');
      if (!tab) return;
      
      const tabId = parseInt(tab.dataset.tabId);
      
      // –Ø–∫—â–æ –∫–ª—ñ–∫–Ω—É–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä–∏—Ç—Ç—è
      if (e.target.classList.contains('tab-close')) {
        e.stopPropagation();
        closeTab(tabId);
      } else {
        // –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É
        switchTab(tabId);
      }
    });
    }
    
    // –ö–Ω–æ–ø–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –≤–∫–ª–∞–¥–∫–∏
    if (newTabBtn) {
        newTabBtn.addEventListener('click', () => {
        createTab();
      });
    }
    
    // –ì–∞—Ä—è—á–∞ –∫–ª–∞–≤—ñ—à–∞ Ctrl+T –¥–ª—è –Ω–æ–≤–æ—ó –≤–∫–ª–∞–¥–∫–∏
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 't') {
        e.preventDefault();
        createTab();
      }
    });

    // ========== –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –≤–∫–ª–∞–¥–æ–∫ —á–µ—Ä–µ–∑ AI ==========
    const organizeTabsBtn = document.getElementById('organize-tabs-btn');
    
    if (organizeTabsBtn) {
      organizeTabsBtn.addEventListener('click', async () => {
      const allTabs = document.querySelectorAll('.tab');
      
      if (allTabs.length < 2) {
        alert('üìå –ü–æ—Ç—Ä—ñ–±–Ω–æ —Ö–æ—á–∞ –± 2 –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó!');
        return;
      }

      // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
      organizeTabsBtn.innerHTML = 'üß† –î—É–º–∞—é...';
      organizeTabsBtn.disabled = true;

      try {
        const result = await ipcRenderer.invoke('organize-tabs');
        
        if (!result.success) {
          alert(result.message || '‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥—Ä—É–ø—É–≤–∞—Ç–∏ –≤–∫–ª–∞–¥–∫–∏');
          organizeTabsBtn.innerHTML = 'üßπ –ù–∞–≤–µ—Å—Ç–∏ –ª–∞–¥';
          organizeTabsBtn.disabled = false;
          return;
        }

        // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
        displayOrganizedGroups(result.groups, result.tabsData);
        
        organizeTabsBtn.innerHTML = '‚úÖ –ì–æ—Ç–æ–≤–æ!';
        setTimeout(() => {
          organizeTabsBtn.innerHTML = 'üßπ –ù–∞–≤–µ—Å—Ç–∏ –ª–∞–¥';
          organizeTabsBtn.disabled = false;
        }, 2000);

      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
        organizeTabsBtn.innerHTML = 'üßπ –ù–∞–≤–µ—Å—Ç–∏ –ª–∞–¥';
        organizeTabsBtn.disabled = false;
      }
    });

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–∏—Ö –≥—Ä—É–ø
    function displayOrganizedGroups(groups, tabsData) {
      // –°—Ç–≤–æ—Ä—é—î–º–æ popup –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
      const popup = document.createElement('div');
      popup.id = 'organize-popup';
      popup.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 3px solid #10b981;
        border-radius: 16px;
        padding: 24px;
        max-width: 600px;
        max-height: 70vh;
        overflow-y: auto;
        z-index: 1000000;
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
        font-family: 'Segoe UI', sans-serif;
      `;
      
      let groupsHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; color: #10b981; font-size: 22px;">üßò‚Äç‚ôÇÔ∏è AI –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞–≤ –≤–∞—à—ñ –≤–∫–ª–∞–¥–∫–∏</h2>
          <button id="close-organize-popup" style="
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 14px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
          ">‚úï</button>
        </div>
      `;

      groups.forEach((group, idx) => {
        const groupColor = ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'][idx % 5];
        
        groupsHTML += `
          <div style="
            margin-bottom: 16px; 
            padding: 16px; 
            background: linear-gradient(135deg, ${groupColor}15, ${groupColor}05);
            border-left: 4px solid ${groupColor};
            border-radius: 10px;
          ">
            <h3 style="margin: 0 0 12px 0; color: ${groupColor}; font-size: 16px; display: flex; align-items: center; gap: 8px;">
              üìÅ ${group.name}
              <span style="font-size: 12px; color: #666; font-weight: normal;">(${group.tabIds.length} –≤–∫–ª–∞–¥–æ–∫)</span>
            </h3>
            <div style="display: flex; flex-direction: column; gap: 8px;">
        `;

        group.tabIds.forEach(tabId => {
          const tabData = tabsData.find(t => t.id === tabId);
          if (tabData) {
            groupsHTML += `
              <div style="
                padding: 10px 12px;
                background: white;
                border-radius: 6px;
                font-size: 13px;
                color: #334155;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                display: flex;
                align-items: center;
                gap: 10px;
              ">
                <img src="https://www.google.com/s2/favicons?domain=${new URL(tabData.url || 'https://google.com').hostname}" 
                     width="16" height="16" 
                     onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2214%22>üåê</text></svg>'"
                     style="flex-shrink: 0;">
                <div style="flex: 1; min-width: 0;">
                  <div style="font-weight: 600; color: ${groupColor}; margin-bottom: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    ${tabData.title}
                  </div>
                  <div style="font-size: 11px; color: #94a3b8; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    ${tabData.url}
                  </div>
                </div>
              </div>
            `;
          }
        });

        groupsHTML += `
            </div>
          </div>
        `;
      });

      groupsHTML += `
        <div style="margin-top: 20px; text-align: center; color: #64748b; font-size: 13px;">
          üí° –ü–æ—Ä–∞–¥–∞: –ó–∞–∫—Ä–∏–π—Ç–µ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω—ñ –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –∫—Ä–∞—â–æ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó
        </div>
      `;

      popup.innerHTML = groupsHTML;
      document.body.appendChild(popup);

      // –ó–∞–∫—Ä–∏—Ç—Ç—è popup
      document.getElementById('close-organize-popup').addEventListener('click', () => {
        popup.remove();
      });

      // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–ª—ñ–∫—É –ø–æ–∑–∞ popup
      popup.addEventListener('click', (e) => {
        if (e.target === popup) {
          popup.remove();
        }
      });
    }
    }

    // ========== –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º ==========
    const settingsBtn = document.getElementById('settings-btn');
    
    if (!settingsBtn) {
      console.error('‚ùå –ö–Ω–æ–ø–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞!');
    } else {
      console.log('‚úì –ö–Ω–æ–ø–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –∑–Ω–∞–π–¥–µ–Ω–∞');
    }
    
    // –ì–æ—Ç–æ–≤—ñ —Ç–µ–º–∏
    const themes = {
      light: {
        name: '‚òÄÔ∏è –°–≤—ñ—Ç–ª–∞',
        colors: {
          '--primary-color': '#3b82f6',
          '--primary-dark': '#1e40af',
          '--primary-light': '#dbeafe',
          '--secondary-color': '#10b981',
          '--background': '#ffffff',
          '--toolbar-bg': '#ffffff',
          '--sidebar-bg': 'linear-gradient(180deg, #f0f9ff 0%, #ffffff 100%)',
          '--text-color': '#1e293b',
          '--border-color': '#e3e8f0',
          '--tab-bg': '#bfdbfe',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#dbeafe'
        }
      },
      dark: {
        name: 'üåô –¢–µ–º–Ω–∞',
        colors: {
          '--primary-color': '#60a5fa',
          '--primary-dark': '#3b82f6',
          '--primary-light': '#1e3a8a',
          '--secondary-color': '#34d399',
          '--background': '#1e293b',
          '--toolbar-bg': '#0f172a',
          '--sidebar-bg': 'linear-gradient(180deg, #1e293b 0%, #0f172a 100%)',
          '--text-color': '#f1f5f9',
          '--border-color': '#334155',
          '--tab-bg': '#334155',
          '--tab-active-bg': '#475569',
          '--button-hover': '#334155'
        }
      },
      ocean: {
        name: 'üåä –û–∫–µ–∞–Ω',
        colors: {
          '--primary-color': '#06b6d4',
          '--primary-dark': '#0891b2',
          '--primary-light': '#cffafe',
          '--secondary-color': '#14b8a6',
          '--background': '#ecfeff',
          '--toolbar-bg': '#cffafe',
          '--sidebar-bg': 'linear-gradient(180deg, #cffafe 0%, #ecfeff 100%)',
          '--text-color': '#164e63',
          '--border-color': '#a5f3fc',
          '--tab-bg': '#a5f3fc',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#a5f3fc'
        }
      },
      forest: {
        name: 'üå≤ –õ—ñ—Å',
        colors: {
          '--primary-color': '#10b981',
          '--primary-dark': '#059669',
          '--primary-light': '#d1fae5',
          '--secondary-color': '#22c55e',
          '--background': '#f0fdf4',
          '--toolbar-bg': '#d1fae5',
          '--sidebar-bg': 'linear-gradient(180deg, #d1fae5 0%, #f0fdf4 100%)',
          '--text-color': '#065f46',
          '--border-color': '#bbf7d0',
          '--tab-bg': '#bbf7d0',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#bbf7d0'
        }
      },
      sunset: {
        name: 'üåÖ –ó–∞—Ö—ñ–¥',
        colors: {
          '--primary-color': '#f59e0b',
          '--primary-dark': '#d97706',
          '--primary-light': '#fef3c7',
          '--secondary-color': '#fb923c',
          '--background': '#fffbeb',
          '--toolbar-bg': '#fef3c7',
          '--sidebar-bg': 'linear-gradient(180deg, #fef3c7 0%, #fffbeb 100%)',
          '--text-color': '#78350f',
          '--border-color': '#fde68a',
          '--tab-bg': '#fde68a',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#fde68a'
        }
      },
      purple: {
        name: 'üíú –§—ñ–æ–ª–µ—Ç–æ–≤–∞',
        colors: {
          '--primary-color': '#a855f7',
          '--primary-dark': '#7e22ce',
          '--primary-light': '#f3e8ff',
          '--secondary-color': '#c084fc',
          '--background': '#faf5ff',
          '--toolbar-bg': '#f3e8ff',
          '--sidebar-bg': 'linear-gradient(180deg, #f3e8ff 0%, #faf5ff 100%)',
          '--text-color': '#581c87',
          '--border-color': '#e9d5ff',
          '--tab-bg': '#e9d5ff',
          '--tab-active-bg': '#ffffff',
          '--button-hover': '#e9d5ff'
        }
      }
    };

    // –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ç–µ–º—É
    function applyTheme(themeName) {
      const theme = themes[themeName];
      if (!theme) return;

      const root = document.documentElement;
      Object.keys(theme.colors).forEach(key => {
        root.style.setProperty(key, theme.colors[key]);
      });

      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—ñ—Ä
      localStorage.setItem('selectedTheme', themeName);
      showNotification(`‚ú® –¢–µ–º—É "${theme.name}" –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ!`);
    }

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
    if (settingsBtn) {
      settingsBtn.addEventListener('click', () => {
        console.log('üé® –í—ñ–¥–∫—Ä–∏–≤–∞—é –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–º');
        showSettingsPopup();
      });
    } else {
      console.error('‚ùå –ù–µ –º–æ–∂—É –¥–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫ - –∫–Ω–æ–ø–∫–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞');
    }

    function showSettingsPopup() {
      const currentTheme = localStorage.getItem('selectedTheme') || 'light';
      
      const popup = document.createElement('div');
      popup.id = 'settings-popup';
      popup.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--background);
        border: 3px solid var(--primary-color);
        border-radius: 20px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        z-index: 1000001;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        font-family: 'Segoe UI', sans-serif;
      `;

      let themesHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
          <h2 style="margin: 0; color: var(--primary-color); font-size: 24px;">‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–º–∏</h2>
          <button id="close-settings-popup" style="
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
          ">‚úï</button>
        </div>

        <div style="margin-bottom: 20px;">
          <h3 style="color: var(--text-color); margin-bottom: 15px; font-size: 16px;">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É:</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
      `;

      Object.keys(themes).forEach(themeKey => {
        const theme = themes[themeKey];
        const isActive = themeKey === currentTheme;
        
        themesHTML += `
          <button class="theme-option" data-theme="${themeKey}" style="
            padding: 16px;
            border: 3px solid ${isActive ? 'var(--primary-color)' : 'var(--border-color)'};
            background: ${isActive ? 'var(--primary-light)' : 'var(--background)'};
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: ${isActive ? 'bold' : 'normal'};
            color: var(--text-color);
            transition: all 0.2s;
            text-align: center;
          ">
            ${theme.name}
          </button>
        `;
      });

      themesHTML += `
          </div>
        </div>

        <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid var(--border-color); text-align: center; color: var(--text-color); font-size: 14px;">
          üí° –¢–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è
        </div>
      `;

      popup.innerHTML = themesHTML;
      document.body.appendChild(popup);

      // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É —Ç–µ–º–∏
      popup.querySelectorAll('.theme-option').forEach(btn => {
        btn.addEventListener('click', () => {
          const themeName = btn.dataset.theme;
          applyTheme(themeName);
          
          // –û–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω –∫–Ω–æ–ø–æ–∫
          popup.querySelectorAll('.theme-option').forEach(b => {
            b.style.border = '3px solid var(--border-color)';
            b.style.background = 'var(--background)';
            b.style.fontWeight = 'normal';
          });
          btn.style.border = '3px solid var(--primary-color)';
          btn.style.background = 'var(--primary-light)';
          btn.style.fontWeight = 'bold';
        });

        // Hover –µ—Ñ–µ–∫—Ç
        btn.addEventListener('mouseenter', () => {
          if (btn.dataset.theme !== currentTheme) {
            btn.style.transform = 'scale(1.05)';
            btn.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
          }
        });
        btn.addEventListener('mouseleave', () => {
          btn.style.transform = 'scale(1)';
          btn.style.boxShadow = 'none';
        });
      });

      // –ó–∞–∫—Ä–∏—Ç—Ç—è popup
      document.getElementById('close-settings-popup').addEventListener('click', () => {
        popup.remove();
      });

      // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ Escape
      const escHandler = (e) => {
        if (e.key === 'Escape') {
          popup.remove();
          document.removeEventListener('keydown', escHandler);
        }
      };
      document.addEventListener('keydown', escHandler);
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É —Ç–µ–º—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    let savedThemeNotes = localStorage.getItem('selectedTheme');
    if (savedThemeNotes && themes[savedThemeNotes]) {
      applyTheme(savedThemeNotes);
    }

    // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —Å—Ç–∞–Ω (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–≥–æ—Ä–Ω—É—Ç–∞)
    if (isSidebarCollapsed) {
      notesSidebar.classList.add('collapsed');
      toggleSidebarBtn.textContent = '‚ò∞';
      toggleSidebarBtn.title = '–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å';
    } else {
      notesSidebar.classList.add('expanded');
      toggleSidebarBtn.textContent = '‚úï';
      toggleSidebarBtn.title = '–ó–≥–æ—Ä–Ω—É—Ç–∏ –ø–∞–Ω–µ–ª—å';
    }

    // –§—É–Ω–∫—Ü—ñ—è toggle –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—Å—é–¥–∏
    function toggleSidebar() {
      isSidebarCollapsed = !isSidebarCollapsed;
      
      // –û—á–∏—â–∞—î–º–æ inline —Å—Ç–∏–ª—ñ, —â–æ–± CSS –∫–ª–∞—Å–∏ –ø—Ä–∞—Ü—é–≤–∞–ª–∏
      notesSidebar.style.width = '';
      notesSidebar.style.padding = '';
      notesSidebar.style.overflow = '';
      notesSidebar.style.borderLeft = '';
      
      if (isSidebarCollapsed) {
        notesSidebar.classList.remove('expanded');
        notesSidebar.classList.add('collapsed');
      } else {
        notesSidebar.classList.remove('collapsed');
        notesSidebar.classList.add('expanded');
      }
      
      toggleSidebarBtn.textContent = isSidebarCollapsed ? '‚ò∞' : '‚úï';
      toggleSidebarBtn.title = isSidebarCollapsed ? '–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞–Ω–µ–ª—å' : '–ó–≥–æ—Ä–Ω—É—Ç–∏ –ø–∞–Ω–µ–ª—å';
      localStorage.setItem('sidebarCollapsed', isSidebarCollapsed);
      ipcRenderer.send('sidebar-toggled', isSidebarCollapsed);
    }

    // –ö–Ω–æ–ø–∫–∞ –≤ toolbar - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤–∂–µ –æ–≥–æ–ª–æ—à–µ–Ω—É –∑–º—ñ–Ω–Ω—É
    if (toggleSidebarToolbar) {
      toggleSidebarToolbar.addEventListener('click', toggleSidebar);
    }

    // –û–±—Ä–æ–±–Ω–∏–∫ toggle –ø–∞–Ω–µ–ª—ñ (–∫–Ω–æ–ø–∫–∞ X –≤ –∑–∞–≥–æ–ª–æ–≤–∫—É) - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤–∂–µ –æ–≥–æ–ª–æ—à–µ–Ω—É –∑–º—ñ–Ω–Ω—É
    if (toggleSidebarBtn) {
      toggleSidebarBtn.addEventListener('click', toggleSidebar);
    }

    // –ì–∞—Ä—è—á–∞ –∫–ª–∞–≤—ñ—à–∞ Ctrl+B –¥–ª—è toggle –ø–∞–Ω–µ–ª—ñ
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'b') {
        e.preventDefault();
        toggleSidebar();
      }
    });

    // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
    if (backBtn) {
      backBtn.addEventListener('click', () => {
        console.log('‚¨ÖÔ∏è –ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∞');
        ipcRenderer.send('go-back');
      });
    }

    if (forwardBtn) {
      forwardBtn.addEventListener('click', () => {
        console.log('‚û°Ô∏è –ö–Ω–æ–ø–∫–∞ –í–ø–µ—Ä–µ–¥ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∞');
        ipcRenderer.send('go-forward');
      });
    }

    if (reloadBtn) {
      reloadBtn.addEventListener('click', () => {
        console.log('üîÑ –ö–Ω–æ–ø–∫–∞ –û–Ω–æ–≤–∏—Ç–∏ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∞');
        ipcRenderer.send('reload');
      });
    }

    if (urlInput) {
      urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          console.log('üîç –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –¥–æ:', urlInput.value);
          ipcRenderer.send('navigate', urlInput.value);
        }
      });
    }

    // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–µ–∫—Å—Ç –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é (–°–ü–Ü–õ–¨–ù–Ü –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    ipcRenderer.on('add-to-notes', (event, text) => {
      addNote(text);
    });

    // –î–æ–¥–∞—î–º–æ –Ω–æ—Ç–∞—Ç–∫—É (—Å–ø—ñ–ª—å–Ω—É –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    function addNote(text) {
      // –í–∏–¥–∞–ª—è—î–º–æ empty state –ø—Ä–∏ –ø–µ—Ä—à—ñ–π –Ω–æ—Ç–∞—Ç—Ü—ñ
      const emptyState = notesList.querySelector('.empty-state');
      if (emptyState) {
        emptyState.remove();
      }

      const noteId = Date.now(); // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –∑–∞–º—ñ—Å—Ç—å —ñ–Ω–¥–µ–∫—Å—É
      collectedNotes.push({ id: noteId, text: text });
      
      const noteItem = document.createElement('div');
      noteItem.className = 'note-item';
      noteItem.dataset.noteId = noteId;
      noteItem.innerHTML = `
        <span>‚Ä¢ ${text}</span>
        <button class="delete-btn" onclick="deleteNote(${noteId})">‚úï</button>
      `;
      
      notesList.appendChild(noteItem);
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage
      localStorage.setItem('sharedNotes', JSON.stringify(collectedNotes));
    }

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–æ—Ç–∞—Ç–∫–∏
    window.deleteNote = function(noteId) {
      const index = collectedNotes.findIndex(note => note.id === noteId);
      if (index !== -1) {
        collectedNotes.splice(index, 1);
        
        // –í–∏–¥–∞–ª—è—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –∑ DOM
        const noteElement = document.querySelector(`[data-note-id="${noteId}"]`);
        if (noteElement) {
          noteElement.remove();
        }
        
        // –ü–æ–∫–∞–∑—É—î–º–æ empty state —è–∫—â–æ –Ω–µ–º–∞—î –Ω–æ—Ç–∞—Ç–æ–∫
        if (collectedNotes.length === 0) {
          notesList.innerHTML = '<div class="empty-state">–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞<br>–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ</div>';
        }
        
        // –û–Ω–æ–≤–ª—é—î–º–æ localStorage
        localStorage.setItem('sharedNotes', JSON.stringify(collectedNotes));
      }
    };

    // –£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –®–Ü (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –°–ü–Ü–õ–¨–ù–Ü –Ω–æ—Ç–∞—Ç–∫–∏)
    if (summarizeBtn) {
      summarizeBtn.addEventListener('click', async () => {
        if (collectedNotes.length === 0) {
          alert('–ö–æ–Ω—Å–ø–µ–∫—Ç –ø–æ—Ä–æ–∂–Ω—ñ–π! –í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ.');
          return;
        }

        // –í–∏—Ç—è–≥—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —Ç–µ–∫—Å—Ç –∑ –æ–±'—î–∫—Ç—ñ–≤ –Ω–æ—Ç–∞—Ç–æ–∫
        const notesText = collectedNotes.map(note => note.text || note).join('\n---\n');
        const prompt = `–Ø –∑—ñ–±—Ä–∞–≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏ –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π —ó—Ö, —Å—Ç—Ä—É–∫—Ç—É—Ä—É–π, –≤–∏–¥–∞–ª–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏ —Ç–∞ —Å—Ç–≤–æ—Ä–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é:\n\n${notesText}`;

        summarizeBtn.textContent = '‚è≥ –î—É–º–∞—é...';
        summarizeBtn.disabled = true;

        try {
          const result = await ipcRenderer.invoke('ask-gemini', prompt);
          
          // –ó–∞–º—ñ–Ω—é—î–º–æ —Å–ø–∏—Å–æ–∫ –Ω–∞ —É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è
          notesList.innerHTML = `<div style="padding: 10px; line-height: 1.6; white-space: pre-wrap;">${result}</div>`;
          collectedNotes = [];
        } catch (error) {
          alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—ñ: ' + error.message);
        } finally {
          summarizeBtn.textContent = '‚ú® –£–∑–∞–≥–∞–ª—å–Ω–∏—Ç–∏ —á–µ—Ä–µ–∑ –®–Ü';
          summarizeBtn.disabled = false;
        }
      });
    }

    // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ (–°–ü–Ü–õ–¨–ù–Ü –Ω–æ—Ç–∞—Ç–∫–∏ –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    if (clearBtn) {
      clearBtn.addEventListener('click', () => {
        if (collectedNotes.length === 0 && !notesList.querySelector('.empty-state')) {
          return;
        }
        
        if (confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –Ω–æ—Ç–∞—Ç–∫–∏?')) {
          collectedNotes = [];
          notesList.innerHTML = '<div class="empty-state">–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ç–∞<br>–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤—É –∫–Ω–æ–ø–∫—É –º–∏—à—ñ</div>';
          localStorage.removeItem('sharedNotes');
        }
      });
    }

    // –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω–∏ –º–æ–≤–∏ –ø–µ—Ä–µ–∫–ª–∞–¥—É
    const translationLanguageSelect = document.getElementById('translation-language');
    if (translationLanguageSelect) {
      translationLanguageSelect.addEventListener('change', (e) => {
        const selectedLanguage = e.target.value;
        console.log('üåê –í–∏–±—Ä–∞–Ω–æ –º–æ–≤—É –ø–µ—Ä–µ–∫–ª–∞–¥—É:', selectedLanguage);
        ipcRenderer.send('change-translation-language', selectedLanguage);
      });
    }

    // Simple settings removed ‚Äî open-settings button deprecated

    // –ú–µ–Ω—é
    const dropdownMenu = document.getElementById('dropdown-menu');
    let currentZoom = 100;

    if (menuBtn && dropdownMenu) {
      // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è/–∑–∞–∫—Ä–∏—Ç—Ç—è –º–µ–Ω—é
      menuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const isNowOpen = !dropdownMenu.classList.contains('active');
        dropdownMenu.classList.toggle('active');
        ipcRenderer.send('menu-toggled', isNowOpen);
      });

      // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
      document.addEventListener('click', (e) => {
        if (!dropdownMenu.contains(e.target) && !menuBtn.contains(e.target)) {
          if (dropdownMenu.classList.contains('active')) {
            dropdownMenu.classList.remove('active');
            ipcRenderer.send('menu-toggled', false);
          }
        }
      });

      // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–µ–Ω—é –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && dropdownMenu.classList.contains('active')) {
          dropdownMenu.classList.remove('active');
          ipcRenderer.send('menu-toggled', false);
        }
      });

      // –ú–∞—Å—à—Ç–∞–±
      const zoomValue = document.getElementById('zoom-value');
      const zoomInBtn = document.getElementById('zoom-in');
      const zoomOutBtn = document.getElementById('zoom-out');
      const zoomResetBtn = document.getElementById('zoom-reset');
      const fullscreenBtn = document.getElementById('fullscreen');

      if (zoomInBtn) {
        zoomInBtn.addEventListener('click', () => {
          currentZoom = Math.min(currentZoom + 10, 200);
          zoomValue.textContent = currentZoom + '%';
          ipcRenderer.send('set-zoom', currentZoom / 100);
        });
      }

      if (zoomOutBtn) {
        zoomOutBtn.addEventListener('click', () => {
          currentZoom = Math.max(currentZoom - 10, 50);
          zoomValue.textContent = currentZoom + '%';
          ipcRenderer.send('set-zoom', currentZoom / 100);
        });
      }

      if (zoomResetBtn) {
        zoomResetBtn.addEventListener('click', () => {
          currentZoom = 100;
          zoomValue.textContent = currentZoom + '%';
          ipcRenderer.send('set-zoom', 1);
        });
      }

      if (fullscreenBtn) {
        fullscreenBtn.addEventListener('click', () => {
          ipcRenderer.send('toggle-fullscreen');
          dropdownMenu.classList.remove('active');
        });
      }

      // –í–∏—Ö—ñ–¥ –∑ –±—Ä–∞—É–∑–µ—Ä–∞
      const exitBtn = document.getElementById('exit-browser');
      if (exitBtn) {
        exitBtn.addEventListener('click', () => {
          ipcRenderer.send('window-close');
        });
      }

      // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—ñ–≤ –Ω–∞ –ø—É–Ω–∫—Ç–∞—Ö –º–µ–Ω—é
      const menuItems = dropdownMenu.querySelectorAll('.menu-item');
      menuItems.forEach(item => {
        const label = item.querySelector('.label')?.textContent;
        
        item.addEventListener('click', () => {
          if (label === '–ù–æ–≤–∞ –≤–∫–ª–∞–¥–∫–∞') {
            createTab();
            dropdownMenu.classList.remove('active');
          } else if (label === '–ù–æ–≤–µ –≤—ñ–∫–Ω–æ') {
            ipcRenderer.send('new-window');
            dropdownMenu.classList.remove('active');
          } else if (label === '–ó–Ω–∞–π—Ç–∏...') {
            // –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø–æ—à—É–∫—É
            dropdownMenu.classList.remove('active');
          } else if (label === '–ü–∞—Ä–∞–º–µ—Ç—Ä–∏') {
            // Open the theme/customize side panel instead (settings.html removed)
            if (typeof openThemePanel === 'function') openThemePanel();
            dropdownMenu.classList.remove('active');
          } else if (label === '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è') {
            ipcRenderer.send('open-downloads');
            dropdownMenu.classList.remove('active');
          }
        });
      });
    }

    // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ç–µ–º–∏
    ipcRenderer.on('theme-changed', (event, theme) => {
      console.log('üé® –û—Ç—Ä–∏–º–∞–Ω–æ –Ω–æ–≤—É —Ç–µ–º—É:', theme.name);
      applyTheme(theme);
    });

    function applyTheme(theme) {
      const colors = theme.colors;
      
      // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ CSS –∑–º—ñ–Ω–Ω—ñ
      const root = document.documentElement;
      root.style.setProperty('--primary', colors.primary);
      root.style.setProperty('--background', colors.background);
      root.style.setProperty('--surface', colors.surface);
      root.style.setProperty('--toolbar', colors.toolbar);
      root.style.setProperty('--tab', colors.tab);
      root.style.setProperty('--tab-active', colors.tabActive);
      root.style.setProperty('--text', colors.text);
      root.style.setProperty('--border', colors.border);

      // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ —Å—Ç–∏–ª—ñ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ
      document.body.style.background = colors.background;
      
      const tabsBar = document.querySelector('.tabs-bar');
      if (tabsBar) tabsBar.style.background = colors.surface;
      
      const toolbar = document.querySelector('.toolbar');
      if (toolbar) toolbar.style.background = colors.toolbar;
      
      // –ê–∫—Ç–∏–≤–Ω–∞ –≤–∫–ª–∞–¥–∫–∞
      const activeTabs = document.querySelectorAll('.tab.active');
      activeTabs.forEach(tab => {
        tab.style.background = colors.tabActive;
      });

      // –ù–µ–∞–∫—Ç–∏–≤–Ω—ñ –≤–∫–ª–∞–¥–∫–∏
      const inactiveTabs = document.querySelectorAll('.tab:not(.active)');
      inactiveTabs.forEach(tab => {
        tab.style.background = colors.tab;
      });

      // Sidebar
      const sidebar = document.getElementById('notes-sidebar');
      if (sidebar) {
        sidebar.style.background = `linear-gradient(to bottom, ${colors.toolbar} 0%, ${colors.background} 100%)`;
        sidebar.style.borderLeft = `1px solid ${colors.border}`;
      }

      // Organize button
      const organizeBtn = document.getElementById('organize-tabs-btn');
      if (organizeBtn) {
        organizeBtn.style.background = `rgba(16, 185, 129, 0.15)`;
        organizeBtn.style.color = colors.primary;
      }

      console.log('‚úÖ –¢–µ–º–∞ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ');
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó —Ç–µ–º–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    let savedThemeMain = localStorage.getItem('browserTheme');
    if (savedThemeMain) {
      const themes = {
        frutti: {
          name: 'Frutti Di Mare',
          colors: {
            primary: '#f7768e',
            secondary: '#ff9e64',
            tertiary: '#e0af68',
            background: '#1a1b26',
            surface: '#1f2335',
            toolbar: '#24283b',
            tab: '#2f3549',
            tabActive: '#f7768e',
            text: '#c0caf5',
            border: '#414868'
          }
        },
        purple: {
          name: 'Purple Haze',
          colors: {
            primary: '#bb9af7',
            secondary: '#9d7cd8',
            tertiary: '#7aa2f7',
            background: '#1a1b26',
            surface: '#1f2335',
            toolbar: '#24283b',
            tab: '#2f3549',
            tabActive: '#bb9af7',
            text: '#c0caf5',
            border: '#414868'
          }
        },
        vaporwave: {
          name: 'Vaporwave',
          colors: {
            primary: '#2ac3de',
            secondary: '#7dcfff',
            tertiary: '#b4f9f8',
            background: '#1a1b26',
            surface: '#1f2335',
            toolbar: '#24283b',
            tab: '#2f3549',
            tabActive: '#2ac3de',
            text: '#c0caf5',
            border: '#414868'
          }
        }
      };
      
      if (themes[savedThemeMain]) {
        applyTheme(themes[savedThemeMain]);
      }
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ (–°–ü–Ü–õ–¨–ù–Ü –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–æ–∫)
    const savedNotes = localStorage.getItem('sharedNotes');
    if (savedNotes) {
      try {
        const parsed = JSON.parse(savedNotes);
        parsed.forEach(note => {
          const text = note.text || note; // –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É
          const noteId = note.id || Date.now() + Math.random();
          
          if (collectedNotes.length === 0) {
            const emptyState = notesList.querySelector('.empty-state');
            if (emptyState) emptyState.remove();
          }
          
          collectedNotes.push({ id: noteId, text: text });
          
          const noteItem = document.createElement('div');
          noteItem.className = 'note-item';
          noteItem.dataset.noteId = noteId;
          noteItem.innerHTML = `
            <span>‚Ä¢ ${text}</span>
            <button class="delete-btn" onclick="deleteNote(${noteId})">‚úï</button>
          `;
          notesList.appendChild(noteItem);
        });
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ—Ç–∞—Ç–æ–∫:', e);
      }
    }
    
    console.log('‚úÖ –í—Å—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ index.html –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ');

    // ===================== –ù–û–í–ê –ü–ê–ù–ï–õ–¨ –ù–ê–õ–ê–®–¢–£–í–ê–ù–¨ =====================
    const themePanel = document.getElementById('theme-panel');
    const themePanelOverlay = document.getElementById('panel-overlay');
    const themeOpenBtn = document.getElementById('theme-settings-btn');
    const themePanelCloseBtn = document.getElementById('close-panel-btn');
    const themeColorButtons = document.querySelectorAll('.color-option');
    const themeModeButtons = document.querySelectorAll('.mode-btn');

    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
    let currentThemeBg = localStorage.getItem('themeBg') || '#1a1b26';
    let currentThemeAccent = localStorage.getItem('themeAccent') || '#3b82f6';
    let currentThemeMode = localStorage.getItem('themeMode') || 'dark';

    // 1. –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –ø–∞–Ω–µ–ª—ñ
    function openThemePanel() {
      if (themePanel && themePanelOverlay) {
        themePanel.classList.add('open');
        themePanelOverlay.classList.add('active');
        ipcRenderer.send('settings-panel-toggled', true);
      }
    }

    // 2. –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–∞–Ω–µ–ª—ñ
    function closeThemePanel() {
      if (themePanel && themePanelOverlay) {
        themePanel.classList.remove('open');
        themePanelOverlay.classList.remove('active');
        ipcRenderer.send('settings-panel-toggled', false);
      }
    }

    // –û–±—Ä–æ–±–Ω–∏–∫–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è/–∑–∞–∫—Ä–∏—Ç—Ç—è
    if (themeOpenBtn) themeOpenBtn.addEventListener('click', openThemePanel);
    if (themePanelCloseBtn) themePanelCloseBtn.addEventListener('click', closeThemePanel);
    if (themePanelOverlay) themePanelOverlay.addEventListener('click', closeThemePanel);

    // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && themePanel && themePanel.classList.contains('open')) {
        closeThemePanel();
      }
    });

    // 3. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ç–µ–º–∏ (CSS –∑–º—ñ–Ω–Ω—ñ - –º–∞–≥—ñ—è!)
    function applyBrowserTheme(bg, accent) {
      document.documentElement.style.setProperty('--theme-bg', bg);
      document.documentElement.style.setProperty('--theme-accent', accent);
      
      // –û–Ω–æ–≤–ª—é—î–º–æ —Ä–µ–∞–ª—å–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
      document.body.style.background = bg;
      
      const toolbarEl = document.querySelector('.toolbar');
      const tabsBarEl = document.querySelector('.tabs-bar');
      
      if (toolbarEl) {
        toolbarEl.style.background = lightenColor(bg, 10);
      }
      if (tabsBarEl) {
        tabsBarEl.style.background = lightenColor(bg, 5);
      }

      // –û–Ω–æ–≤–ª—é—î–º–æ tabs –∞–∫—Ç–∏–≤–Ω–∏–π –∫–æ–ª—ñ—Ä
      document.querySelectorAll('.tab.active').forEach(tab => {
        tab.style.background = accent;
      });

      // –û–Ω–æ–≤–ª—é—î–º–æ Preview
      updateThemePreviewBox(bg, accent);

      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ
      localStorage.setItem('themeBg', bg);
      localStorage.setItem('themeAccent', accent);
      currentThemeBg = bg;
      currentThemeAccent = accent;
    }

    // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É
    function lightenColor(color, percent) {
      const num = parseInt(color.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return '#' + (0x1000000 + 
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
        (B < 255 ? B < 1 ? 0 : B : 255)
      ).toString(16).slice(1);
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è Preview Box
    function updateThemePreviewBox(bg, accent) {
      const previewBox = document.getElementById('preview-box');
      if (previewBox) {
        previewBox.style.borderColor = accent;
        const previewTab = previewBox.querySelector('.preview-mini-tab');
        const previewContent = previewBox.querySelector('.preview-mini-content');
        const previewToolbar = previewBox.querySelector('.preview-mini-toolbar');
        
        if (previewTab) previewTab.style.background = accent;
        if (previewContent) previewContent.style.background = bg;
        if (previewToolbar) previewToolbar.style.background = lightenColor(bg, 10);
      }
    }

    // 4. –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É –Ω–∞ –∫–æ–ª—å–æ—Ä–æ–≤—ñ –∫—Ä—É–∂–µ—á–∫–∏
    themeColorButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const newBg = btn.getAttribute('data-bg');
        const newAccent = btn.getAttribute('data-accent');

        if (newBg === 'custom' || newAccent === 'custom') {
          // –ö–∞—Å—Ç–æ–º–Ω–∏–π –∫–æ–ª—ñ—Ä
          const colorInput = document.createElement('input');
          colorInput.type = 'color';
          colorInput.value = currentThemeAccent;
          colorInput.addEventListener('change', () => {
            applyBrowserTheme(currentThemeBg, colorInput.value);
            updateThemeColorActive(btn);
          });
          colorInput.click();
        } else {
          applyBrowserTheme(newBg, newAccent);
          updateThemeColorActive(btn);
        }
      });
    });

    function updateThemeColorActive(activeBtn) {
      themeColorButtons.forEach(b => b.classList.remove('active'));
      activeBtn.classList.add('active');
    }

    // 5. –°–≤—ñ—Ç–ª–∞/–¢–µ–º–Ω–∞ —Ç–µ–º–∞
    themeModeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        themeModeButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const mode = btn.getAttribute('data-mode');
        currentThemeMode = mode;
        localStorage.setItem('themeMode', mode);
        
        if (mode === 'light') {
          applyBrowserTheme('#f5f5f5', currentThemeAccent);
          document.documentElement.style.setProperty('--theme-text', '#1f2937');
          document.documentElement.style.setProperty('--theme-surface', '#ffffff');
        } else if (mode === 'dark') {
          applyBrowserTheme('#1a1b26', currentThemeAccent);
          document.documentElement.style.setProperty('--theme-text', '#c0caf5');
          document.documentElement.style.setProperty('--theme-surface', '#24283b');
        } else {
          // System
          const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          if (isDark) {
            applyBrowserTheme('#1a1b26', currentThemeAccent);
          } else {
            applyBrowserTheme('#f5f5f5', currentThemeAccent);
          }
        }
      });
    });

    // 6. Toggle switches
    document.querySelectorAll('.toggle-switch').forEach(toggle => {
      toggle.addEventListener('click', () => {
        toggle.classList.toggle('active');
      });
    });

    // 7. –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –∑ –º–µ–Ω—é
    const customizeMenuItem = document.getElementById('customize-menu');
    if (customizeMenuItem) {
      customizeMenuItem.addEventListener('click', () => {
        const dropdownMenu = document.getElementById('dropdown-menu');
        if (dropdownMenu) dropdownMenu.classList.remove('active');
        ipcRenderer.send('menu-toggled', false);
        openThemePanel();
      });
    }

    // 8. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É —Ç–µ–º—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    applyBrowserTheme(currentThemeBg, currentThemeAccent);
    
    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π —Ä–µ–∂–∏–º
    themeModeButtons.forEach(btn => {
      btn.classList.remove('active');
      if (btn.dataset.mode === currentThemeMode) {
        btn.classList.add('active');
      }
    });

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–æ–ª—ñ—Ä
    themeColorButtons.forEach(btn => {
      if (btn.dataset.accent === currentThemeAccent) {
        btn.classList.add('active');
      }
    });

    // ========== WALLPAPERS SECTION ==========
    const wallpaperCards = document.querySelectorAll('.wallpaper-card[data-wallpaper]');
    const uploadWallpaperCard = document.getElementById('upload-wallpaper');
    const uploadWallpaperBtn = document.getElementById('upload-wallpaper-btn');
    const clearWallpaperBtn = document.getElementById('clear-wallpaper');
    const wallpaperFileInput = document.getElementById('wallpaper-file-input');

    let currentWallpaper = localStorage.getItem('wallpaper') || 'none';

    // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —à–ø–∞–ª–µ—Ä—ñ–≤
    function applyWallpaper(wallpaperData) {
      const bodyEl = document.body;
      
      if (!wallpaperData || wallpaperData === 'none') {
        bodyEl.style.backgroundImage = 'none';
        bodyEl.classList.remove('has-wallpaper');
        localStorage.removeItem('wallpaper');
        currentWallpaper = 'none';
      } else if (wallpaperData.startsWith('data:') || wallpaperData.startsWith('http')) {
        // –ö–∞—Å—Ç–æ–º–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ (base64 –∞–±–æ URL)
        bodyEl.style.backgroundImage = `url(${wallpaperData})`;
        bodyEl.style.backgroundSize = 'cover';
        bodyEl.style.backgroundPosition = 'center';
        bodyEl.style.backgroundRepeat = 'no-repeat';
        bodyEl.classList.add('has-wallpaper');
        localStorage.setItem('wallpaper', wallpaperData);
        currentWallpaper = wallpaperData;
      } else {
        // –ì—Ä–∞–¥—ñ—î–Ω—Ç–Ω—ñ –ø—Ä–µ—Å–µ—Ç–∏
        const wallpaperCard = document.querySelector(`[data-wallpaper="${wallpaperData}"]`);
        if (wallpaperCard) {
          const bgImage = wallpaperCard.style.backgroundImage;
          bodyEl.style.backgroundImage = bgImage;
          bodyEl.style.backgroundSize = 'cover';
          bodyEl.style.backgroundPosition = 'center';
          bodyEl.classList.add('has-wallpaper');
          localStorage.setItem('wallpaper', wallpaperData);
          currentWallpaper = wallpaperData;
        }
      }

      // –û–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω –∫–∞—Ä—Ç–æ–∫
      updateWallpaperActive(wallpaperData);
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—ó –∫–∞—Ä—Ç–∫–∏
    function updateWallpaperActive(wallpaperData) {
      wallpaperCards.forEach(card => card.classList.remove('active'));
      
      if (!wallpaperData || wallpaperData === 'none') {
        const noneCard = document.querySelector('[data-wallpaper="none"]');
        if (noneCard) noneCard.classList.add('active');
      } else if (wallpaperData.startsWith('data:') || wallpaperData.startsWith('http')) {
        uploadWallpaperCard.classList.add('active');
      } else {
        const activeCard = document.querySelector(`[data-wallpaper="${wallpaperData}"]`);
        if (activeCard) activeCard.classList.add('active');
      }
    }

    // –ö–ª—ñ–∫ –Ω–∞ –∫–∞—Ä—Ç–∫–∏ —à–ø–∞–ª–µ—Ä—ñ–≤
    wallpaperCards.forEach(card => {
      card.addEventListener('click', () => {
        const wallpaper = card.dataset.wallpaper;
        applyWallpaper(wallpaper);
      });
    });

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö —à–ø–∞–ª–µ—Ä—ñ–≤
    if (uploadWallpaperCard) {
      uploadWallpaperCard.addEventListener('click', () => {
        wallpaperFileInput.click();
      });
    }

    if (uploadWallpaperBtn) {
      uploadWallpaperBtn.addEventListener('click', () => {
        wallpaperFileInput.click();
      });
    }

    if (wallpaperFileInput) {
      wallpaperFileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑–º—ñ—Ä—É (–º–∞–∫—Å 5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert('‚ùå –§–∞–π–ª –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π! –ú–∞–∫—Å–∏–º—É–º 5 –ú–ë.');
          return;
        }

        const reader = new FileReader();
        reader.onload = (event) => {
          const imageData = event.target.result;
          applyWallpaper(imageData);
        };
        reader.readAsDataURL(file);
      });
    }

    // –û—á–∏—Å—Ç–∏—Ç–∏ —à–ø–∞–ª–µ—Ä–∏
    if (clearWallpaperBtn) {
      clearWallpaperBtn.addEventListener('click', () => {
        applyWallpaper('none');
      });
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —à–ø–∞–ª–µ—Ä–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    if (currentWallpaper && currentWallpaper !== 'none') {
      applyWallpaper(currentWallpaper);
    } else {
      updateWallpaperActive('none');
    }
    
    console.log('‚úÖ –ü–∞–Ω–µ–ª—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –≥–æ—Ç–æ–≤–∞');

    // ===================== END –ü–ê–ù–ï–õ–¨ –ù–ê–õ–ê–®–¢–£–í–ê–ù–¨ =====================
    
  } catch (error) {
    console.error('‚ùå –ö–†–ò–¢–ò–ß–ù–ê –ü–û–ú–ò–õ–ö–ê –≤ index.html:', error);
    alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—Ä–∞—É–∑–µ—Ä–∞: ' + error.message);
  }
  </script>
</body>
</html>
